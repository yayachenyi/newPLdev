var cov_w70j9q1ct=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/cron/sendExternalGraderStats.js',hash='4ddccacf9ce5050956a666f78f787696027ca35d',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/cron/sendExternalGraderStats.js',statementMap:{'0':{start:{line:1,column:12},end:{line:1,column:39}},'1':{start:{line:3,column:15},end:{line:3,column:39}},'2':{start:{line:4,column:15},end:{line:4,column:39}},'3':{start:{line:5,column:15},end:{line:5,column:39}},'4':{start:{line:6,column:14},end:{line:6,column:37}},'5':{start:{line:8,column:0},end:{line:8,column:20}},'6':{start:{line:10,column:0},end:{line:51,column:2}},'7':{start:{line:11,column:4},end:{line:11,column:57}},'8':{start:{line:11,column:35},end:{line:11,column:57}},'9':{start:{line:12,column:4},end:{line:50,column:7}},'10':{start:{line:13,column:8},end:{line:13,column:39}},'11':{start:{line:13,column:32},end:{line:13,column:39}},'12':{start:{line:26,column:12},end:{line:26,column:26}},'13':{start:{line:28,column:18},end:{line:28,column:102}},'14':{start:{line:29,column:8},end:{line:29,column:40}},'15':{start:{line:30,column:8},end:{line:30,column:84}},'16':{start:{line:31,column:8},end:{line:31,column:43}},'17':{start:{line:32,column:8},end:{line:32,column:95}},'18':{start:{line:33,column:8},end:{line:33,column:92}},'19':{start:{line:34,column:8},end:{line:34,column:95}},'20':{start:{line:35,column:8},end:{line:35,column:88}},'21':{start:{line:36,column:8},end:{line:36,column:82}},'22':{start:{line:37,column:8},end:{line:37,column:43}},'23':{start:{line:38,column:8},end:{line:38,column:93}},'24':{start:{line:39,column:8},end:{line:39,column:90}},'25':{start:{line:40,column:8},end:{line:40,column:93}},'26':{start:{line:41,column:8},end:{line:41,column:86}},'27':{start:{line:43,column:8},end:{line:49,column:11}},'28':{start:{line:44,column:12},end:{line:44,column:43}},'29':{start:{line:44,column:36},end:{line:44,column:43}},'30':{start:{line:45,column:12},end:{line:47,column:13}},'31':{start:{line:46,column:16},end:{line:46,column:116}},'32':{start:{line:48,column:12},end:{line:48,column:27}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:10,column:21},end:{line:10,column:22}},loc:{start:{line:10,column:35},end:{line:51,column:1}},line:10},'1':{name:'(anonymous_1)',decl:{start:{line:12,column:51},end:{line:12,column:52}},loc:{start:{line:12,column:73},end:{line:50,column:5}},line:12},'2':{name:'(anonymous_2)',decl:{start:{line:43,column:32},end:{line:43,column:33}},loc:{start:{line:43,column:52},end:{line:49,column:9}},line:43}},branchMap:{'0':{loc:{start:{line:11,column:4},end:{line:11,column:57}},type:'if',locations:[{start:{line:11,column:4},end:{line:11,column:57}},{start:{line:11,column:4},end:{line:11,column:57}}],line:11},'1':{loc:{start:{line:13,column:8},end:{line:13,column:39}},type:'if',locations:[{start:{line:13,column:8},end:{line:13,column:39}},{start:{line:13,column:8},end:{line:13,column:39}}],line:13},'2':{loc:{start:{line:44,column:12},end:{line:44,column:43}},type:'if',locations:[{start:{line:44,column:12},end:{line:44,column:43}},{start:{line:44,column:12},end:{line:44,column:43}}],line:44},'3':{loc:{start:{line:45,column:12},end:{line:47,column:13}},type:'if',locations:[{start:{line:45,column:12},end:{line:47,column:13}},{start:{line:45,column:12},end:{line:47,column:13}}],line:45}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0},f:{'0':0,'1':0,'2':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const ERR=(++cov_w70j9q1ct.s[0],require('async-stacktrace'));const config=(++cov_w70j9q1ct.s[1],require('../lib/config'));const logger=(++cov_w70j9q1ct.s[2],require('../lib/logger'));const opsbot=(++cov_w70j9q1ct.s[3],require('../lib/opsbot'));const sqldb=(++cov_w70j9q1ct.s[4],require('../lib/sqldb'));++cov_w70j9q1ct.s[5];module.exports={};++cov_w70j9q1ct.s[6];module.exports.run=callback=>{++cov_w70j9q1ct.f[0];++cov_w70j9q1ct.s[7];if(!opsbot.canSendMessages()){++cov_w70j9q1ct.b[0][0];++cov_w70j9q1ct.s[8];return callback(null);}else{++cov_w70j9q1ct.b[0][1];}++cov_w70j9q1ct.s[9];sqldb.callOneRow('grading_jobs_stats_day',[],function(err,result){++cov_w70j9q1ct.f[1];++cov_w70j9q1ct.s[10];if(ERR(err,callback)){++cov_w70j9q1ct.b[1][0];++cov_w70j9q1ct.s[11];return;}else{++cov_w70j9q1ct.b[1][1];}const{count,delta_total,delta_submitted_at,delta_started_at,delta_finished_at,delta_final,max_total,max_submitted_at,max_started_at,max_finished_at,max_final}=(++cov_w70j9q1ct.s[12],result.rows[0]);let msg=(++cov_w70j9q1ct.s[13],`_External grading stats, past 24 hours:_ *${config.externalGradingSqsQueueName}*\n`);++cov_w70j9q1ct.s[14];msg+=`Count: *${count}*\n`;++cov_w70j9q1ct.s[15];msg+=`Average total duration: *${Number(delta_total).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[16];msg+=`Individual averages:\n`;++cov_w70j9q1ct.s[17];msg+=`    Average time to submit: *${Number(delta_submitted_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[18];msg+=`    Average time to queue: *${Number(delta_started_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[19];msg+=`    Average time to execute: *${Number(delta_finished_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[20];msg+=`    Average time to report: *${Number(delta_final).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[21];msg+=`Maximum total duration: *${Number(max_total).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[22];msg+=`Individual maximums:\n`;++cov_w70j9q1ct.s[23];msg+=`    Maximum time to submit: *${Number(max_submitted_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[24];msg+=`    Maximum time to queue: *${Number(max_started_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[25];msg+=`    Maximum time to execute: *${Number(max_finished_at).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[26];msg+=`    Maximum time to report: *${Number(max_final).toFixed(2)} s*\n`;++cov_w70j9q1ct.s[27];opsbot.sendMessage(msg,(err,res,body)=>{++cov_w70j9q1ct.f[2];++cov_w70j9q1ct.s[28];if(ERR(err,callback)){++cov_w70j9q1ct.b[2][0];++cov_w70j9q1ct.s[29];return;}else{++cov_w70j9q1ct.b[2][1];}++cov_w70j9q1ct.s[30];if(res.statusCode!=200){++cov_w70j9q1ct.b[3][0];++cov_w70j9q1ct.s[31];logger.error('Error posting external grading stats to slack [status code ${res.statusCode}]',body);}else{++cov_w70j9q1ct.b[3][1];}++cov_w70j9q1ct.s[32];callback(null);});});};