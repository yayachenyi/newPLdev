var cov_ikhy0oqt4=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/question-servers/calculation.js',hash='4be648a568a6b03ca39769ca580d24a3de3db74d',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/question-servers/calculation.js',statementMap:{'0':{start:{line:1,column:10},end:{line:1,column:37}},'1':{start:{line:2,column:11},end:{line:2,column:26}},'2':{start:{line:3,column:8},end:{line:3,column:25}},'3':{start:{line:5,column:12},end:{line:5,column:35}},'4':{start:{line:6,column:16},end:{line:6,column:44}},'5':{start:{line:7,column:22},end:{line:7,column:56}},'6':{start:{line:9,column:0},end:{line:154,column:2}},'7':{start:{line:11,column:8},end:{line:28,column:11}},'8':{start:{line:12,column:12},end:{line:12,column:43}},'9':{start:{line:12,column:36},end:{line:12,column:43}},'10':{start:{line:13,column:32},end:{line:20,column:14}},'11':{start:{line:21,column:12},end:{line:27,column:15}},'12':{start:{line:22,column:16},end:{line:22,column:113}},'13':{start:{line:22,column:42},end:{line:22,column:113}},'14':{start:{line:23,column:16},end:{line:26,column:22}},'15':{start:{line:25,column:20},end:{line:25,column:50}},'16':{start:{line:32,column:22},end:{line:37,column:9}},'17':{start:{line:35,column:54},end:{line:35,column:56}},'18':{start:{line:38,column:8},end:{line:38,column:34}},'19':{start:{line:42,column:26},end:{line:42,column:81}},'20':{start:{line:43,column:8},end:{line:64,column:11}},'21':{start:{line:44,column:12},end:{line:44,column:43}},'22':{start:{line:44,column:36},end:{line:44,column:43}},'23':{start:{line:45,column:26},end:{line:45,column:48}},'24':{start:{line:46,column:12},end:{line:57,column:13}},'25':{start:{line:47,column:26},end:{line:47,column:38}},'26':{start:{line:48,column:35},end:{line:48,column:76}},'27':{start:{line:50,column:27},end:{line:54,column:17}},'28':{start:{line:55,column:16},end:{line:55,column:33}},'29':{start:{line:56,column:16},end:{line:56,column:63}},'30':{start:{line:58,column:23},end:{line:62,column:13}},'31':{start:{line:63,column:12},end:{line:63,column:37}},'32':{start:{line:68,column:21},end:{line:72,column:9}},'33':{start:{line:73,column:8},end:{line:73,column:33}},'34':{start:{line:77,column:8},end:{line:97,column:11}},'35':{start:{line:78,column:12},end:{line:78,column:43}},'36':{start:{line:78,column:36},end:{line:78,column:43}},'37':{start:{line:80,column:12},end:{line:95,column:13}},'38':{start:{line:81,column:26},end:{line:81,column:46}},'39':{start:{line:82,column:29},end:{line:82,column:43}},'40':{start:{line:83,column:33},end:{line:83,column:52}},'41':{start:{line:84,column:30},end:{line:84,column:45}},'42':{start:{line:85,column:34},end:{line:85,column:89}},'43':{start:{line:86,column:16},end:{line:86,column:99}},'44':{start:{line:88,column:27},end:{line:92,column:17}},'45':{start:{line:93,column:16},end:{line:93,column:33}},'46':{start:{line:94,column:16},end:{line:94,column:63}},'47':{start:{line:96,column:12},end:{line:96,column:37}},'48':{start:{line:101,column:21},end:{line:108,column:9}},'49':{start:{line:109,column:8},end:{line:109,column:33}},'50':{start:{line:113,column:8},end:{line:152,column:11}},'51':{start:{line:114,column:12},end:{line:114,column:43}},'52':{start:{line:114,column:36},end:{line:114,column:43}},'53':{start:{line:116,column:12},end:{line:133,column:13}},'54':{start:{line:117,column:26},end:{line:117,column:46}},'55':{start:{line:118,column:29},end:{line:118,column:43}},'56':{start:{line:119,column:33},end:{line:119,column:52}},'57':{start:{line:120,column:38},end:{line:120,column:65}},'58':{start:{line:121,column:30},end:{line:121,column:45}},'59':{start:{line:122,column:34},end:{line:122,column:89}},'60':{start:{line:123,column:16},end:{line:123,column:109}},'61':{start:{line:125,column:29},end:{line:130,column:17}},'62':{start:{line:131,column:16},end:{line:131,column:33}},'63':{start:{line:132,column:16},end:{line:132,column:63}},'64':{start:{line:135,column:24},end:{line:135,column:37}},'65':{start:{line:136,column:12},end:{line:139,column:13}},'66':{start:{line:138,column:16},end:{line:138,column:55}},'67':{start:{line:140,column:25},end:{line:150,column:13}},'68':{start:{line:151,column:12},end:{line:151,column:37}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:10,column:16},end:{line:10,column:17}},loc:{start:{line:10,column:53},end:{line:29,column:5}},line:10},'1':{name:'(anonymous_1)',decl:{start:{line:11,column:91},end:{line:11,column:92}},loc:{start:{line:11,column:125},end:{line:28,column:9}},line:11},'2':{name:'(anonymous_2)',decl:{start:{line:21,column:48},end:{line:21,column:49}},loc:{start:{line:21,column:65},end:{line:27,column:13}},line:21},'3':{name:'(anonymous_3)',decl:{start:{line:23,column:27},end:{line:23,column:28}},loc:{start:{line:23,column:38},end:{line:26,column:17}},line:23},'4':{name:'(anonymous_4)',decl:{start:{line:31,column:12},end:{line:31,column:13}},loc:{start:{line:31,column:125},end:{line:39,column:5}},line:31},'5':{name:'(anonymous_5)',decl:{start:{line:35,column:48},end:{line:35,column:49}},loc:{start:{line:35,column:54},end:{line:35,column:56}},line:35},'6':{name:'(anonymous_6)',decl:{start:{line:41,column:14},end:{line:41,column:15}},loc:{start:{line:41,column:65},end:{line:65,column:5}},line:41},'7':{name:'(anonymous_7)',decl:{start:{line:43,column:52},end:{line:43,column:53}},loc:{start:{line:43,column:74},end:{line:64,column:9}},line:43},'8':{name:'(anonymous_8)',decl:{start:{line:67,column:13},end:{line:67,column:14}},loc:{start:{line:67,column:59},end:{line:74,column:5}},line:67},'9':{name:'(anonymous_9)',decl:{start:{line:76,column:13},end:{line:76,column:14}},loc:{start:{line:76,column:69},end:{line:98,column:5}},line:76},'10':{name:'(anonymous_10)',decl:{start:{line:77,column:52},end:{line:77,column:53}},loc:{start:{line:77,column:74},end:{line:97,column:9}},line:77},'11':{name:'(anonymous_11)',decl:{start:{line:100,column:11},end:{line:100,column:12}},loc:{start:{line:100,column:69},end:{line:110,column:5}},line:100},'12':{name:'(anonymous_12)',decl:{start:{line:112,column:11},end:{line:112,column:12}},loc:{start:{line:112,column:69},end:{line:153,column:5}},line:112},'13':{name:'(anonymous_13)',decl:{start:{line:113,column:52},end:{line:113,column:53}},loc:{start:{line:113,column:74},end:{line:152,column:9}},line:113}},branchMap:{'0':{loc:{start:{line:12,column:12},end:{line:12,column:43}},type:'if',locations:[{start:{line:12,column:12},end:{line:12,column:43}},{start:{line:12,column:12},end:{line:12,column:43}}],line:12},'1':{loc:{start:{line:22,column:16},end:{line:22,column:113}},type:'if',locations:[{start:{line:22,column:16},end:{line:22,column:113}},{start:{line:22,column:16},end:{line:22,column:113}}],line:22},'2':{loc:{start:{line:44,column:12},end:{line:44,column:43}},type:'if',locations:[{start:{line:44,column:12},end:{line:44,column:43}},{start:{line:44,column:12},end:{line:44,column:43}}],line:44},'3':{loc:{start:{line:45,column:26},end:{line:45,column:48}},type:'binary-expr',locations:[{start:{line:45,column:26},end:{line:45,column:42}},{start:{line:45,column:46},end:{line:45,column:48}}],line:45},'4':{loc:{start:{line:61,column:25},end:{line:61,column:71}},type:'binary-expr',locations:[{start:{line:61,column:25},end:{line:61,column:45}},{start:{line:61,column:49},end:{line:61,column:65}},{start:{line:61,column:69},end:{line:61,column:71}}],line:61},'5':{loc:{start:{line:78,column:12},end:{line:78,column:43}},type:'if',locations:[{start:{line:78,column:12},end:{line:78,column:43}},{start:{line:78,column:12},end:{line:78,column:43}}],line:78},'6':{loc:{start:{line:114,column:12},end:{line:114,column:43}},type:'if',locations:[{start:{line:114,column:12},end:{line:114,column:43}},{start:{line:114,column:12},end:{line:114,column:43}}],line:114},'7':{loc:{start:{line:136,column:12},end:{line:139,column:13}},type:'if',locations:[{start:{line:136,column:12},end:{line:139,column:13}},{start:{line:136,column:12},end:{line:139,column:13}}],line:136},'8':{loc:{start:{line:138,column:24},end:{line:138,column:54}},type:'cond-expr',locations:[{start:{line:138,column:49},end:{line:138,column:50}},{start:{line:138,column:53},end:{line:138,column:54}}],line:138}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var ERR=(++cov_ikhy0oqt4.s[0],require('async-stacktrace'));var path=(++cov_ikhy0oqt4.s[1],require('path'));var _=(++cov_ikhy0oqt4.s[2],require('lodash'));var error=(++cov_ikhy0oqt4.s[3],require('../lib/error'));var filePaths=(++cov_ikhy0oqt4.s[4],require('../lib/file-paths'));var requireFrontend=(++cov_ikhy0oqt4.s[5],require('../lib/require-frontend'));++cov_ikhy0oqt4.s[6];module.exports={loadServer:function(question,course,callback){++cov_ikhy0oqt4.f[0];++cov_ikhy0oqt4.s[7];filePaths.questionFilePath('server.js',question.directory,course.path,question,function(err,questionServerPath){++cov_ikhy0oqt4.f[1];++cov_ikhy0oqt4.s[8];if(ERR(err,callback)){++cov_ikhy0oqt4.b[0][0];++cov_ikhy0oqt4.s[9];return;}else{++cov_ikhy0oqt4.b[0][1];}var configRequire=(++cov_ikhy0oqt4.s[10],requireFrontend.config({paths:{clientFilesCourse:path.join(course.path,'clientFilesCourse'),serverFilesCourse:path.join(course.path,'serverFilesCourse'),clientCode:path.join(course.path,'clientFilesCourse'),serverCode:path.join(course.path,'serverFilesCourse')}}));++cov_ikhy0oqt4.s[11];configRequire([questionServerPath],function(server){++cov_ikhy0oqt4.f[2];++cov_ikhy0oqt4.s[12];if(server===undefined){++cov_ikhy0oqt4.b[1][0];++cov_ikhy0oqt4.s[13];return callback('Unable to load "server.js" for qid: '+question.qid);}else{++cov_ikhy0oqt4.b[1][1];}++cov_ikhy0oqt4.s[14];setTimeout(function(){++cov_ikhy0oqt4.f[3];++cov_ikhy0oqt4.s[15];// use a setTimeout() to get out of requireJS error handling
return callback(null,server);},0);});});},render:function(renderSelection,variant,question,submission,submissions,course,course_instance,locals,callback){++cov_ikhy0oqt4.f[4];const htmls=(++cov_ikhy0oqt4.s[16],{extraHeadersHtml:'',questionHtml:'',submissionHtmls:_.map(submissions,()=>{++cov_ikhy0oqt4.f[5];++cov_ikhy0oqt4.s[17];return'';}),answerHtml:''});++cov_ikhy0oqt4.s[18];callback(null,[],htmls);},generate:function(question,course,variant_seed,callback){++cov_ikhy0oqt4.f[6];var questionDir=(++cov_ikhy0oqt4.s[19],path.join(course.path,'questions',question.directory));++cov_ikhy0oqt4.s[20];module.exports.loadServer(question,course,function(err,server){++cov_ikhy0oqt4.f[7];++cov_ikhy0oqt4.s[21];if(ERR(err,callback)){++cov_ikhy0oqt4.b[2][0];++cov_ikhy0oqt4.s[22];return;}else{++cov_ikhy0oqt4.b[2][1];}var options=(++cov_ikhy0oqt4.s[23],(++cov_ikhy0oqt4.b[3][0],question.options)||(++cov_ikhy0oqt4.b[3][1],{}));++cov_ikhy0oqt4.s[24];try{var vid=(++cov_ikhy0oqt4.s[25],variant_seed);var questionData=(++cov_ikhy0oqt4.s[26],server.getData(vid,options,questionDir));}catch(err){let data=(++cov_ikhy0oqt4.s[27],{variant_seed:variant_seed,question:question,course:course});++cov_ikhy0oqt4.s[28];err.status=500;++cov_ikhy0oqt4.s[29];return ERR(error.addData(err,data),callback);}let data=(++cov_ikhy0oqt4.s[30],{params:questionData.params,true_answer:questionData.trueAnswer,options:(++cov_ikhy0oqt4.b[4][0],questionData.options)||(++cov_ikhy0oqt4.b[4][1],question.options)||(++cov_ikhy0oqt4.b[4][2],{})});++cov_ikhy0oqt4.s[31];callback(null,[],data);});},prepare:function(question,course,variant,callback){++cov_ikhy0oqt4.f[8];const data=(++cov_ikhy0oqt4.s[32],{params:variant.params,true_answer:variant.true_answer,options:variant.options});++cov_ikhy0oqt4.s[33];callback(null,[],data);},getFile:function(filename,variant,question,course,callback){++cov_ikhy0oqt4.f[9];++cov_ikhy0oqt4.s[34];module.exports.loadServer(question,course,function(err,server){++cov_ikhy0oqt4.f[10];++cov_ikhy0oqt4.s[35];if(ERR(err,callback)){++cov_ikhy0oqt4.b[5][0];++cov_ikhy0oqt4.s[36];return;}else{++cov_ikhy0oqt4.b[5][1];}var fileData;++cov_ikhy0oqt4.s[37];try{var vid=(++cov_ikhy0oqt4.s[38],variant.variant_seed);var params=(++cov_ikhy0oqt4.s[39],variant.params);var trueAnswer=(++cov_ikhy0oqt4.s[40],variant.true_answer);var options=(++cov_ikhy0oqt4.s[41],variant.options);var questionDir=(++cov_ikhy0oqt4.s[42],path.join(course.path,'questions',question.directory));++cov_ikhy0oqt4.s[43];fileData=server.getFile(filename,vid,params,trueAnswer,options,questionDir);}catch(err){var data=(++cov_ikhy0oqt4.s[44],{variant:variant,question:question,course:course});++cov_ikhy0oqt4.s[45];err.status=500;++cov_ikhy0oqt4.s[46];return ERR(error.addData(err,data),callback);}++cov_ikhy0oqt4.s[47];callback(null,fileData);});},parse:function(submission,variant,question,course,callback){++cov_ikhy0oqt4.f[11];const data=(++cov_ikhy0oqt4.s[48],{params:variant.params,true_answer:variant.true_answer,submitted_answer:submission.submitted_answer,raw_submitted_answer:submission.raw_submitted_answer,format_errors:{},gradable:true});++cov_ikhy0oqt4.s[49];callback(null,[],data);},grade:function(submission,variant,question,course,callback){++cov_ikhy0oqt4.f[12];++cov_ikhy0oqt4.s[50];module.exports.loadServer(question,course,function(err,server){++cov_ikhy0oqt4.f[13];++cov_ikhy0oqt4.s[51];if(ERR(err,callback)){++cov_ikhy0oqt4.b[6][0];++cov_ikhy0oqt4.s[52];return;}else{++cov_ikhy0oqt4.b[6][1];}var grading;++cov_ikhy0oqt4.s[53];try{var vid=(++cov_ikhy0oqt4.s[54],variant.variant_seed);var params=(++cov_ikhy0oqt4.s[55],variant.params);var trueAnswer=(++cov_ikhy0oqt4.s[56],variant.true_answer);var submittedAnswer=(++cov_ikhy0oqt4.s[57],submission.submitted_answer);var options=(++cov_ikhy0oqt4.s[58],variant.options);var questionDir=(++cov_ikhy0oqt4.s[59],path.join(course.path,'questions',question.directory));++cov_ikhy0oqt4.s[60];grading=server.gradeAnswer(vid,params,trueAnswer,submittedAnswer,options,questionDir);}catch(err){const data=(++cov_ikhy0oqt4.s[61],{submission:submission,variant:variant,question:question,course:course});++cov_ikhy0oqt4.s[62];err.status=500;++cov_ikhy0oqt4.s[63];return ERR(error.addData(err,data),callback);}let score=(++cov_ikhy0oqt4.s[64],grading.score);++cov_ikhy0oqt4.s[65];if(!question.partial_credit){++cov_ikhy0oqt4.b[7][0];++cov_ikhy0oqt4.s[66];// legacy Calculation questions round the score to 0 or 1 (with 0.5 rounding up)
score=grading.score>=0.5?(++cov_ikhy0oqt4.b[8][0],1):(++cov_ikhy0oqt4.b[8][1],0);}else{++cov_ikhy0oqt4.b[7][1];}const data=(++cov_ikhy0oqt4.s[67],{score:score,v2_score:grading.score,feedback:grading.feedback,partial_scores:{},submitted_answer:submission.submitted_answer,format_errors:{},gradable:true,params:variant.params,true_answer:variant.true_answer});++cov_ikhy0oqt4.s[68];callback(null,[],data);});}};