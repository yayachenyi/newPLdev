var cov_mv8zrzwmo=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/externalGraderLocal.js',hash='f0eaf507a622721a0f359e8763aa2d7c8e086dfc',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/externalGraderLocal.js',statementMap:{'0':{start:{line:1,column:12},end:{line:1,column:39}},'1':{start:{line:2,column:14},end:{line:2,column:30}},'2':{start:{line:3,column:13},end:{line:3,column:28}},'3':{start:{line:4,column:15},end:{line:4,column:35}},'4':{start:{line:5,column:11},end:{line:5,column:24}},'5':{start:{line:6,column:21},end:{line:6,column:38}},'6':{start:{line:7,column:11},end:{line:7,column:30}},'7':{start:{line:8,column:17},end:{line:8,column:41}},'8':{start:{line:9,column:15},end:{line:9,column:32}},'9':{start:{line:11,column:15},end:{line:11,column:34}},'10':{start:{line:12,column:29},end:{line:12,column:62}},'11':{start:{line:13,column:15},end:{line:13,column:34}},'12':{start:{line:14,column:14},end:{line:14,column:32}},'13':{start:{line:15,column:18},end:{line:15,column:41}},'14':{start:{line:17,column:12},end:{line:17,column:46}},'15':{start:{line:21,column:24},end:{line:21,column:42}},'16':{start:{line:23,column:24},end:{line:23,column:26}},'17':{start:{line:25,column:20},end:{line:25,column:54}},'18':{start:{line:26,column:24},end:{line:26,column:62}},'19':{start:{line:27,column:24},end:{line:27,column:97}},'20':{start:{line:29,column:23},end:{line:29,column:35}},'21':{start:{line:32,column:8},end:{line:34,column:14}},'22':{start:{line:33,column:12},end:{line:33,column:35}},'23':{start:{line:36,column:21},end:{line:36,column:23}},'24':{start:{line:37,column:8},end:{line:204,column:11}},'25':{start:{line:39,column:16},end:{line:42,column:19}},'26':{start:{line:40,column:20},end:{line:40,column:51}},'27':{start:{line:40,column:44},end:{line:40,column:51}},'28':{start:{line:41,column:20},end:{line:41,column:35}},'29':{start:{line:45,column:16},end:{line:45,column:65}},'30':{start:{line:46,column:16},end:{line:46,column:31}},'31':{start:{line:49,column:16},end:{line:52,column:19}},'32':{start:{line:50,column:20},end:{line:50,column:51}},'33':{start:{line:50,column:44},end:{line:50,column:51}},'34':{start:{line:51,column:20},end:{line:51,column:35}},'35':{start:{line:55,column:16},end:{line:60,column:19}},'36':{start:{line:56,column:20},end:{line:58,column:21}},'37':{start:{line:57,column:24},end:{line:57,column:101}},'38':{start:{line:59,column:20},end:{line:59,column:35}},'39':{start:{line:63,column:16},end:{line:76,column:19}},'40':{start:{line:64,column:20},end:{line:68,column:21}},'41':{start:{line:65,column:24},end:{line:65,column:140}},'42':{start:{line:66,column:24},end:{line:66,column:41}},'43':{start:{line:67,column:24},end:{line:67,column:46}},'44':{start:{line:70,column:20},end:{line:75,column:23}},'45':{start:{line:71,column:24},end:{line:71,column:55}},'46':{start:{line:71,column:48},end:{line:71,column:55}},'47':{start:{line:72,column:24},end:{line:72,column:39}},'48':{start:{line:74,column:24},end:{line:74,column:44}},'49':{start:{line:79,column:16},end:{line:93,column:19}},'50':{start:{line:91,column:20},end:{line:91,column:51}},'51':{start:{line:91,column:44},end:{line:91,column:51}},'52':{start:{line:92,column:20},end:{line:92,column:46}},'53':{start:{line:96,column:16},end:{line:109,column:19}},'54':{start:{line:101,column:20},end:{line:101,column:51}},'55':{start:{line:101,column:44},end:{line:101,column:51}},'56':{start:{line:102,column:32},end:{line:102,column:46}},'57':{start:{line:103,column:20},end:{line:107,column:23}},'58':{start:{line:104,column:40},end:{line:104,column:77}},'59':{start:{line:105,column:24},end:{line:105,column:45}},'60':{start:{line:106,column:24},end:{line:106,column:51}},'61':{start:{line:108,column:20},end:{line:108,column:46}},'62':{start:{line:112,column:16},end:{line:117,column:19}},'63':{start:{line:113,column:20},end:{line:113,column:51}},'64':{start:{line:113,column:44},end:{line:113,column:51}},'65':{start:{line:115,column:20},end:{line:115,column:66}},'66':{start:{line:116,column:20},end:{line:116,column:46}},'67':{start:{line:120,column:34},end:{line:124,column:34}},'68':{start:{line:121,column:20},end:{line:121,column:71}},'69':{start:{line:122,column:20},end:{line:122,column:37}},'70':{start:{line:123,column:20},end:{line:123,column:44}},'71':{start:{line:125,column:16},end:{line:130,column:19}},'72':{start:{line:126,column:20},end:{line:126,column:44}},'73':{start:{line:127,column:20},end:{line:127,column:51}},'74':{start:{line:127,column:44},end:{line:127,column:51}},'75':{start:{line:128,column:20},end:{line:128,column:64}},'76':{start:{line:129,column:20},end:{line:129,column:46}},'77':{start:{line:133,column:16},end:{line:137,column:19}},'78':{start:{line:134,column:20},end:{line:134,column:51}},'79':{start:{line:134,column:44},end:{line:134,column:51}},'80':{start:{line:135,column:20},end:{line:135,column:88}},'81':{start:{line:136,column:20},end:{line:136,column:46}},'82':{start:{line:140,column:16},end:{line:143,column:19}},'83':{start:{line:141,column:20},end:{line:141,column:51}},'84':{start:{line:141,column:44},end:{line:141,column:51}},'85':{start:{line:142,column:20},end:{line:142,column:35}},'86':{start:{line:147,column:37},end:{line:150,column:17}},'87':{start:{line:151,column:16},end:{line:154,column:19}},'88':{start:{line:152,column:20},end:{line:152,column:69}},'89':{start:{line:152,column:42},end:{line:152,column:59}},'90':{start:{line:152,column:62},end:{line:152,column:69}},'91':{start:{line:153,column:20},end:{line:153,column:35}},'92':{start:{line:157,column:16},end:{line:157,column:59}},'93':{start:{line:158,column:16},end:{line:158,column:48}},'94':{start:{line:161,column:16},end:{line:196,column:17}},'95':{start:{line:162,column:20},end:{line:187,column:23}},'96':{start:{line:163,column:24},end:{line:185,column:25}},'97':{start:{line:164,column:28},end:{line:164,column:72}},'98':{start:{line:165,column:28},end:{line:165,column:54}},'99':{start:{line:167,column:28},end:{line:184,column:29}},'100':{start:{line:169,column:32},end:{line:169,column:58}},'101':{start:{line:170,column:32},end:{line:172,column:101}},'102':{start:{line:174,column:32},end:{line:183,column:33}},'103':{start:{line:175,column:36},end:{line:175,column:60}},'104':{start:{line:176,column:36},end:{line:176,column:71}},'105':{start:{line:177,column:36},end:{line:177,column:61}},'106':{start:{line:179,column:36},end:{line:179,column:81}},'107':{start:{line:180,column:36},end:{line:180,column:52}},'108':{start:{line:181,column:36},end:{line:181,column:62}},'109':{start:{line:182,column:36},end:{line:182,column:93}},'110':{start:{line:186,column:24},end:{line:186,column:111}},'111':{start:{line:189,column:20},end:{line:189,column:43}},'112':{start:{line:191,column:20},end:{line:193,column:21}},'113':{start:{line:192,column:24},end:{line:192,column:88}},'114':{start:{line:195,column:20},end:{line:195,column:107}},'115':{start:{line:199,column:12},end:{line:203,column:13}},'116':{start:{line:200,column:16},end:{line:200,column:43}},'117':{start:{line:202,column:16},end:{line:202,column:55}},'118':{start:{line:206,column:8},end:{line:206,column:23}},'119':{start:{line:220,column:4},end:{line:231,column:5}},'120':{start:{line:222,column:8},end:{line:222,column:50}},'121':{start:{line:225,column:8},end:{line:230,column:9}},'122':{start:{line:227,column:12},end:{line:227,column:40}},'123':{start:{line:229,column:12},end:{line:229,column:84}},'124':{start:{line:242,column:4},end:{line:248,column:5}},'125':{start:{line:244,column:8},end:{line:244,column:82}},'126':{start:{line:247,column:8},end:{line:247,column:41}},'127':{start:{line:251,column:0},end:{line:251,column:24}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:20,column:4},end:{line:20,column:5}},loc:{start:{line:20,column:77},end:{line:207,column:5}},line:20},'1':{name:'(anonymous_1)',decl:{start:{line:32,column:19},end:{line:32,column:20}},loc:{start:{line:32,column:25},end:{line:34,column:9}},line:32},'2':{name:'(anonymous_2)',decl:{start:{line:38,column:12},end:{line:38,column:13}},loc:{start:{line:38,column:26},end:{line:43,column:13}},line:38},'3':{name:'(anonymous_3)',decl:{start:{line:39,column:28},end:{line:39,column:29}},loc:{start:{line:39,column:37},end:{line:42,column:17}},line:39},'4':{name:'(anonymous_4)',decl:{start:{line:44,column:12},end:{line:44,column:13}},loc:{start:{line:44,column:26},end:{line:47,column:13}},line:44},'5':{name:'(anonymous_5)',decl:{start:{line:48,column:12},end:{line:48,column:13}},loc:{start:{line:48,column:26},end:{line:53,column:13}},line:48},'6':{name:'(anonymous_6)',decl:{start:{line:49,column:96},end:{line:49,column:97}},loc:{start:{line:49,column:105},end:{line:52,column:17}},line:49},'7':{name:'(anonymous_7)',decl:{start:{line:54,column:12},end:{line:54,column:13}},loc:{start:{line:54,column:26},end:{line:61,column:13}},line:54},'8':{name:'(anonymous_8)',decl:{start:{line:55,column:98},end:{line:55,column:99}},loc:{start:{line:55,column:107},end:{line:60,column:17}},line:55},'9':{name:'(anonymous_9)',decl:{start:{line:62,column:12},end:{line:62,column:13}},loc:{start:{line:62,column:26},end:{line:77,column:13}},line:62},'10':{name:'(anonymous_10)',decl:{start:{line:63,column:61},end:{line:63,column:62}},loc:{start:{line:63,column:78},end:{line:76,column:17}},line:63},'11':{name:'(anonymous_11)',decl:{start:{line:70,column:56},end:{line:70,column:57}},loc:{start:{line:70,column:65},end:{line:73,column:21}},line:70},'12':{name:'(anonymous_12)',decl:{start:{line:73,column:23},end:{line:73,column:24}},loc:{start:{line:73,column:35},end:{line:75,column:21}},line:73},'13':{name:'(anonymous_13)',decl:{start:{line:78,column:12},end:{line:78,column:13}},loc:{start:{line:78,column:26},end:{line:94,column:13}},line:78},'14':{name:'(anonymous_14)',decl:{start:{line:90,column:19},end:{line:90,column:20}},loc:{start:{line:90,column:39},end:{line:93,column:17}},line:90},'15':{name:'(anonymous_15)',decl:{start:{line:95,column:12},end:{line:95,column:13}},loc:{start:{line:95,column:37},end:{line:110,column:13}},line:95},'16':{name:'(anonymous_16)',decl:{start:{line:100,column:19},end:{line:100,column:20}},loc:{start:{line:100,column:36},end:{line:109,column:17}},line:100},'17':{name:'(anonymous_17)',decl:{start:{line:103,column:35},end:{line:103,column:36}},loc:{start:{line:103,column:45},end:{line:107,column:21}},line:103},'18':{name:'(anonymous_18)',decl:{start:{line:111,column:12},end:{line:111,column:13}},loc:{start:{line:111,column:37},end:{line:118,column:13}},line:111},'19':{name:'(anonymous_19)',decl:{start:{line:112,column:32},end:{line:112,column:33}},loc:{start:{line:112,column:41},end:{line:117,column:17}},line:112},'20':{name:'(anonymous_20)',decl:{start:{line:119,column:12},end:{line:119,column:13}},loc:{start:{line:119,column:37},end:{line:131,column:13}},line:119},'21':{name:'(anonymous_21)',decl:{start:{line:120,column:45},end:{line:120,column:46}},loc:{start:{line:120,column:51},end:{line:124,column:17}},line:120},'22':{name:'(anonymous_22)',decl:{start:{line:125,column:31},end:{line:125,column:32}},loc:{start:{line:125,column:40},end:{line:130,column:17}},line:125},'23':{name:'(anonymous_23)',decl:{start:{line:132,column:12},end:{line:132,column:13}},loc:{start:{line:132,column:37},end:{line:138,column:13}},line:132},'24':{name:'(anonymous_24)',decl:{start:{line:133,column:34},end:{line:133,column:35}},loc:{start:{line:133,column:49},end:{line:137,column:17}},line:133},'25':{name:'(anonymous_25)',decl:{start:{line:139,column:12},end:{line:139,column:13}},loc:{start:{line:139,column:37},end:{line:144,column:13}},line:139},'26':{name:'(anonymous_26)',decl:{start:{line:140,column:33},end:{line:140,column:34}},loc:{start:{line:140,column:42},end:{line:143,column:17}},line:140},'27':{name:'(anonymous_27)',decl:{start:{line:145,column:12},end:{line:145,column:13}},loc:{start:{line:145,column:26},end:{line:155,column:13}},line:145},'28':{name:'(anonymous_28)',decl:{start:{line:151,column:65},end:{line:151,column:66}},loc:{start:{line:151,column:83},end:{line:154,column:17}},line:151},'29':{name:'(anonymous_29)',decl:{start:{line:152,column:33},end:{line:152,column:34}},loc:{start:{line:152,column:42},end:{line:152,column:59}},line:152},'30':{name:'(anonymous_30)',decl:{start:{line:156,column:12},end:{line:156,column:13}},loc:{start:{line:156,column:26},end:{line:197,column:13}},line:156},'31':{name:'(anonymous_31)',decl:{start:{line:162,column:75},end:{line:162,column:76}},loc:{start:{line:162,column:90},end:{line:187,column:21}},line:162},'32':{name:'(anonymous_32)',decl:{start:{line:198,column:11},end:{line:198,column:12}},loc:{start:{line:198,column:35},end:{line:204,column:9}},line:198},'33':{name:'getDevJobDirectory',decl:{start:{line:219,column:9},end:{line:219,column:27}},loc:{start:{line:219,column:35},end:{line:232,column:1}},line:219},'34':{name:'getDevHostJobDirectory',decl:{start:{line:241,column:9},end:{line:241,column:31}},loc:{start:{line:241,column:39},end:{line:249,column:1}},line:241}},branchMap:{'0':{loc:{start:{line:27,column:24},end:{line:27,column:97}},type:'binary-expr',locations:[{start:{line:27,column:24},end:{line:27,column:57}},{start:{line:27,column:61},end:{line:27,column:97}}],line:27},'1':{loc:{start:{line:40,column:20},end:{line:40,column:51}},type:'if',locations:[{start:{line:40,column:20},end:{line:40,column:51}},{start:{line:40,column:20},end:{line:40,column:51}}],line:40},'2':{loc:{start:{line:50,column:20},end:{line:50,column:51}},type:'if',locations:[{start:{line:50,column:20},end:{line:50,column:51}},{start:{line:50,column:20},end:{line:50,column:51}}],line:50},'3':{loc:{start:{line:56,column:20},end:{line:58,column:21}},type:'if',locations:[{start:{line:56,column:20},end:{line:58,column:21}},{start:{line:56,column:20},end:{line:58,column:21}}],line:56},'4':{loc:{start:{line:64,column:20},end:{line:68,column:21}},type:'if',locations:[{start:{line:64,column:20},end:{line:68,column:21}},{start:{line:64,column:20},end:{line:68,column:21}}],line:64},'5':{loc:{start:{line:71,column:24},end:{line:71,column:55}},type:'if',locations:[{start:{line:71,column:24},end:{line:71,column:55}},{start:{line:71,column:24},end:{line:71,column:55}}],line:71},'6':{loc:{start:{line:91,column:20},end:{line:91,column:51}},type:'if',locations:[{start:{line:91,column:20},end:{line:91,column:51}},{start:{line:91,column:20},end:{line:91,column:51}}],line:91},'7':{loc:{start:{line:101,column:20},end:{line:101,column:51}},type:'if',locations:[{start:{line:101,column:20},end:{line:101,column:51}},{start:{line:101,column:20},end:{line:101,column:51}}],line:101},'8':{loc:{start:{line:113,column:20},end:{line:113,column:51}},type:'if',locations:[{start:{line:113,column:20},end:{line:113,column:51}},{start:{line:113,column:20},end:{line:113,column:51}}],line:113},'9':{loc:{start:{line:127,column:20},end:{line:127,column:51}},type:'if',locations:[{start:{line:127,column:20},end:{line:127,column:51}},{start:{line:127,column:20},end:{line:127,column:51}}],line:127},'10':{loc:{start:{line:134,column:20},end:{line:134,column:51}},type:'if',locations:[{start:{line:134,column:20},end:{line:134,column:51}},{start:{line:134,column:20},end:{line:134,column:51}}],line:134},'11':{loc:{start:{line:135,column:41},end:{line:135,column:86}},type:'binary-expr',locations:[{start:{line:135,column:41},end:{line:135,column:58}},{start:{line:135,column:62},end:{line:135,column:86}}],line:135},'12':{loc:{start:{line:141,column:20},end:{line:141,column:51}},type:'if',locations:[{start:{line:141,column:20},end:{line:141,column:51}},{start:{line:141,column:20},end:{line:141,column:51}}],line:141},'13':{loc:{start:{line:152,column:20},end:{line:152,column:69}},type:'if',locations:[{start:{line:152,column:20},end:{line:152,column:69}},{start:{line:152,column:20},end:{line:152,column:69}}],line:152},'14':{loc:{start:{line:161,column:16},end:{line:196,column:17}},type:'if',locations:[{start:{line:161,column:16},end:{line:196,column:17}},{start:{line:161,column:16},end:{line:196,column:17}}],line:161},'15':{loc:{start:{line:163,column:24},end:{line:185,column:25}},type:'if',locations:[{start:{line:163,column:24},end:{line:185,column:25}},{start:{line:163,column:24},end:{line:185,column:25}}],line:163},'16':{loc:{start:{line:167,column:28},end:{line:184,column:29}},type:'if',locations:[{start:{line:167,column:28},end:{line:184,column:29}},{start:{line:167,column:28},end:{line:184,column:29}}],line:167},'17':{loc:{start:{line:191,column:20},end:{line:193,column:21}},type:'if',locations:[{start:{line:191,column:20},end:{line:193,column:21}},{start:{line:191,column:20},end:{line:193,column:21}}],line:191},'18':{loc:{start:{line:199,column:12},end:{line:203,column:13}},type:'if',locations:[{start:{line:199,column:12},end:{line:203,column:13}},{start:{line:199,column:12},end:{line:203,column:13}}],line:199},'19':{loc:{start:{line:220,column:4},end:{line:231,column:5}},type:'if',locations:[{start:{line:220,column:4},end:{line:231,column:5}},{start:{line:220,column:4},end:{line:231,column:5}}],line:220},'20':{loc:{start:{line:225,column:8},end:{line:230,column:9}},type:'if',locations:[{start:{line:225,column:8},end:{line:230,column:9}},{start:{line:225,column:8},end:{line:230,column:9}}],line:225},'21':{loc:{start:{line:242,column:4},end:{line:248,column:5}},type:'if',locations:[{start:{line:242,column:4},end:{line:248,column:5}},{start:{line:242,column:4},end:{line:248,column:5}}],line:242}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0,'87':0,'88':0,'89':0,'90':0,'91':0,'92':0,'93':0,'94':0,'95':0,'96':0,'97':0,'98':0,'99':0,'100':0,'101':0,'102':0,'103':0,'104':0,'105':0,'106':0,'107':0,'108':0,'109':0,'110':0,'111':0,'112':0,'113':0,'114':0,'115':0,'116':0,'117':0,'118':0,'119':0,'120':0,'121':0,'122':0,'123':0,'124':0,'125':0,'126':0,'127':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0],'16':[0,0],'17':[0,0],'18':[0,0],'19':[0,0],'20':[0,0],'21':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const ERR=(++cov_mv8zrzwmo.s[0],require('async-stacktrace'));const async=(++cov_mv8zrzwmo.s[1],require('async'));const path=(++cov_mv8zrzwmo.s[2],require('path'));const Docker=(++cov_mv8zrzwmo.s[3],require('dockerode'));const os=(++cov_mv8zrzwmo.s[4],require('os'));const EventEmitter=(++cov_mv8zrzwmo.s[5],require('events'));const fs=(++cov_mv8zrzwmo.s[6],require('fs-extra'));const{exec}=(++cov_mv8zrzwmo.s[7],require('child_process'));const byline=(++cov_mv8zrzwmo.s[8],require('byline'));const logger=(++cov_mv8zrzwmo.s[9],require('./logger'));const externalGraderCommon=(++cov_mv8zrzwmo.s[10],require('./externalGraderCommon'));const config=(++cov_mv8zrzwmo.s[11],require('./config'));const sqldb=(++cov_mv8zrzwmo.s[12],require('./sqldb'));const sqlLoader=(++cov_mv8zrzwmo.s[13],require('./sql-loader'));const sql=(++cov_mv8zrzwmo.s[14],sqlLoader.loadSqlEquiv(__filename));class Grader{handleGradingRequest(grading_job,submission,variant,question,course){++cov_mv8zrzwmo.f[0];const emitter=(++cov_mv8zrzwmo.s[15],new EventEmitter());const results=(++cov_mv8zrzwmo.s[16],{});const dir=(++cov_mv8zrzwmo.s[17],getDevJobDirectory(grading_job.id));const hostDir=(++cov_mv8zrzwmo.s[18],getDevHostJobDirectory(grading_job.id));const timeout=(++cov_mv8zrzwmo.s[19],(++cov_mv8zrzwmo.b[0][0],question.external_grading_timeout)||(++cov_mv8zrzwmo.b[0][1],config.externalGradingDefaultTimeout));const docker=(++cov_mv8zrzwmo.s[20],new Docker());// Delay until emitter has been returned and listener attached.
++cov_mv8zrzwmo.s[21];setTimeout(()=>{++cov_mv8zrzwmo.f[1];++cov_mv8zrzwmo.s[22];emitter.emit('submit');},0);let output=(++cov_mv8zrzwmo.s[23],'');++cov_mv8zrzwmo.s[24];async.waterfall([callback=>{++cov_mv8zrzwmo.f[2];++cov_mv8zrzwmo.s[25];docker.ping(err=>{++cov_mv8zrzwmo.f[3];++cov_mv8zrzwmo.s[26];if(ERR(err,callback)){++cov_mv8zrzwmo.b[1][0];++cov_mv8zrzwmo.s[27];return;}else{++cov_mv8zrzwmo.b[1][1];}++cov_mv8zrzwmo.s[28];callback(null);});},callback=>{++cov_mv8zrzwmo.f[4];++cov_mv8zrzwmo.s[29];results.received_time=new Date().toISOString();++cov_mv8zrzwmo.s[30];callback(null);},callback=>{++cov_mv8zrzwmo.f[5];++cov_mv8zrzwmo.s[31];externalGraderCommon.buildDirectory(dir,submission,variant,question,course,err=>{++cov_mv8zrzwmo.f[6];++cov_mv8zrzwmo.s[32];if(ERR(err,callback)){++cov_mv8zrzwmo.b[2][0];++cov_mv8zrzwmo.s[33];return;}else{++cov_mv8zrzwmo.b[2][1];}++cov_mv8zrzwmo.s[34];callback(null);});},callback=>{++cov_mv8zrzwmo.f[7];++cov_mv8zrzwmo.s[35];exec(`chmod +x ${path.join(dir,question.external_grading_entrypoint.slice(6))}`,err=>{++cov_mv8zrzwmo.f[8];++cov_mv8zrzwmo.s[36];if(err){++cov_mv8zrzwmo.b[3][0];++cov_mv8zrzwmo.s[37];logger.error('Could not make file executable; continuing execution anyways');}else{++cov_mv8zrzwmo.b[3][1];}++cov_mv8zrzwmo.s[38];callback(null);});},callback=>{++cov_mv8zrzwmo.f[9];++cov_mv8zrzwmo.s[39];docker.pull(question.external_grading_image,(err,stream)=>{++cov_mv8zrzwmo.f[10];++cov_mv8zrzwmo.s[40];if(err){++cov_mv8zrzwmo.b[4][0];++cov_mv8zrzwmo.s[41];logger.warn(`Error pulling "${question.external_grading_image}" image; attempting to fall back to cached version.`);++cov_mv8zrzwmo.s[42];logger.warn(err);++cov_mv8zrzwmo.s[43];return callback(null);}else{++cov_mv8zrzwmo.b[4][1];}++cov_mv8zrzwmo.s[44];docker.modem.followProgress(stream,err=>{++cov_mv8zrzwmo.f[11];++cov_mv8zrzwmo.s[45];if(ERR(err,callback)){++cov_mv8zrzwmo.b[5][0];++cov_mv8zrzwmo.s[46];return;}else{++cov_mv8zrzwmo.b[5][1];}++cov_mv8zrzwmo.s[47];callback(null);},output=>{++cov_mv8zrzwmo.f[12];++cov_mv8zrzwmo.s[48];logger.info(output);});});},callback=>{++cov_mv8zrzwmo.f[13];++cov_mv8zrzwmo.s[49];docker.createContainer({Image:question.external_grading_image,AttachStdout:true,AttachStderr:true,Tty:true,HostConfig:{Binds:[`${hostDir}:/grade`]},Entrypoint:question.external_grading_entrypoint.split(' ')},(err,container)=>{++cov_mv8zrzwmo.f[14];++cov_mv8zrzwmo.s[50];if(ERR(err,callback)){++cov_mv8zrzwmo.b[6][0];++cov_mv8zrzwmo.s[51];return;}else{++cov_mv8zrzwmo.b[6][1];}++cov_mv8zrzwmo.s[52];callback(null,container);});},(container,callback)=>{++cov_mv8zrzwmo.f[15];++cov_mv8zrzwmo.s[53];container.attach({stream:true,stdout:true,stderr:true},(err,stream)=>{++cov_mv8zrzwmo.f[16];++cov_mv8zrzwmo.s[54];if(ERR(err,callback)){++cov_mv8zrzwmo.b[7][0];++cov_mv8zrzwmo.s[55];return;}else{++cov_mv8zrzwmo.b[7][1];}const out=(++cov_mv8zrzwmo.s[56],byline(stream));++cov_mv8zrzwmo.s[57];out.on('data',line=>{++cov_mv8zrzwmo.f[17];const newline=(++cov_mv8zrzwmo.s[58],`container> ${line.toString('utf8')}`);++cov_mv8zrzwmo.s[59];logger.info(newline);++cov_mv8zrzwmo.s[60];output+=newline+'\n';});++cov_mv8zrzwmo.s[61];callback(null,container);});},(container,callback)=>{++cov_mv8zrzwmo.f[18];++cov_mv8zrzwmo.s[62];container.start(err=>{++cov_mv8zrzwmo.f[19];++cov_mv8zrzwmo.s[63];if(ERR(err,callback)){++cov_mv8zrzwmo.b[8][0];++cov_mv8zrzwmo.s[64];return;}else{++cov_mv8zrzwmo.b[8][1];}++cov_mv8zrzwmo.s[65];results.start_time=new Date().toISOString();++cov_mv8zrzwmo.s[66];callback(null,container);});},(container,callback)=>{++cov_mv8zrzwmo.f[20];const timeoutId=(++cov_mv8zrzwmo.s[67],setTimeout(()=>{++cov_mv8zrzwmo.f[21];++cov_mv8zrzwmo.s[68];logger.info('Timeout exceeded; killing container');++cov_mv8zrzwmo.s[69];container.kill();++cov_mv8zrzwmo.s[70];results.timedOut=true;},timeout*1000));++cov_mv8zrzwmo.s[71];container.wait(err=>{++cov_mv8zrzwmo.f[22];++cov_mv8zrzwmo.s[72];clearTimeout(timeoutId);++cov_mv8zrzwmo.s[73];if(ERR(err,callback)){++cov_mv8zrzwmo.b[9][0];++cov_mv8zrzwmo.s[74];return;}else{++cov_mv8zrzwmo.b[9][1];}++cov_mv8zrzwmo.s[75];results.end_time=new Date().toISOString();++cov_mv8zrzwmo.s[76];callback(null,container);});},(container,callback)=>{++cov_mv8zrzwmo.f[23];++cov_mv8zrzwmo.s[77];container.inspect((err,data)=>{++cov_mv8zrzwmo.f[24];++cov_mv8zrzwmo.s[78];if(ERR(err,callback)){++cov_mv8zrzwmo.b[10][0];++cov_mv8zrzwmo.s[79];return;}else{++cov_mv8zrzwmo.b[10][1];}++cov_mv8zrzwmo.s[80];results.succeeded=(++cov_mv8zrzwmo.b[11][0],!results.timedOut)&&(++cov_mv8zrzwmo.b[11][1],data.State.ExitCode==0);++cov_mv8zrzwmo.s[81];callback(null,container);});},(container,callback)=>{++cov_mv8zrzwmo.f[25];++cov_mv8zrzwmo.s[82];container.remove(err=>{++cov_mv8zrzwmo.f[26];++cov_mv8zrzwmo.s[83];if(ERR(err,callback)){++cov_mv8zrzwmo.b[12][0];++cov_mv8zrzwmo.s[84];return;}else{++cov_mv8zrzwmo.b[12][1];}++cov_mv8zrzwmo.s[85];callback(null);});},callback=>{++cov_mv8zrzwmo.f[27];// Save job output
const outputParams=(++cov_mv8zrzwmo.s[86],{grading_job_id:grading_job.id,output});++cov_mv8zrzwmo.s[87];sqldb.query(sql.update_job_output,outputParams,(err,_result)=>{++cov_mv8zrzwmo.f[28];++cov_mv8zrzwmo.s[88];if(ERR(err,err=>{++cov_mv8zrzwmo.f[29];++cov_mv8zrzwmo.s[89];return logger.error(err);})){++cov_mv8zrzwmo.b[13][0];++cov_mv8zrzwmo.s[90];return;}else{++cov_mv8zrzwmo.b[13][1];}++cov_mv8zrzwmo.s[91];callback(null);});},callback=>{++cov_mv8zrzwmo.f[30];++cov_mv8zrzwmo.s[92];logger.info('Constructing results object');++cov_mv8zrzwmo.s[93];results.job_id=grading_job.id;// Now that the job has completed, let's extract the results
// First up: results.json
++cov_mv8zrzwmo.s[94];if(results.succeeded){++cov_mv8zrzwmo.b[14][0];++cov_mv8zrzwmo.s[95];fs.readFile(path.join(dir,'results','results.json'),(err,data)=>{++cov_mv8zrzwmo.f[31];++cov_mv8zrzwmo.s[96];if(err){++cov_mv8zrzwmo.b[15][0];++cov_mv8zrzwmo.s[97];logger.error('Could not read results.json');++cov_mv8zrzwmo.s[98];results.succeeded=false;}else{++cov_mv8zrzwmo.b[15][1];++cov_mv8zrzwmo.s[99];if(Buffer.byteLength(data)>100*1024){++cov_mv8zrzwmo.b[16][0];++cov_mv8zrzwmo.s[100];// Cap output at 100 KiB
results.succeeded=false;++cov_mv8zrzwmo.s[101];results.message='The grading results were larger than 100 KiB. '+'Try removing print statements from your code to reduce the output size. '+'If the problem persists, please contact course staff or a proctor.';}else{++cov_mv8zrzwmo.b[16][1];++cov_mv8zrzwmo.s[102];try{++cov_mv8zrzwmo.s[103];logger.info('parsing!');++cov_mv8zrzwmo.s[104];results.results=JSON.parse(data);++cov_mv8zrzwmo.s[105];results.succeeded=true;}catch(e){++cov_mv8zrzwmo.s[106];logger.error('Could not parse results.json');++cov_mv8zrzwmo.s[107];logger.error(e);++cov_mv8zrzwmo.s[108];results.succeeded=false;++cov_mv8zrzwmo.s[109];results.message='Could not parse the grading results.';}}}++cov_mv8zrzwmo.s[110];return callback(null,externalGraderCommon.makeGradingResult(grading_job.id,results));});}else{++cov_mv8zrzwmo.b[14][1];++cov_mv8zrzwmo.s[111];results.results=null;++cov_mv8zrzwmo.s[112];if(results.timedOut){++cov_mv8zrzwmo.b[17][0];++cov_mv8zrzwmo.s[113];results.message=`Grading timed out after ${timeout} seconds.`;}else{++cov_mv8zrzwmo.b[17][1];}++cov_mv8zrzwmo.s[114];return callback(null,externalGraderCommon.makeGradingResult(grading_job.id,results));}}],(err,gradingResult)=>{++cov_mv8zrzwmo.f[32];++cov_mv8zrzwmo.s[115];if(err){++cov_mv8zrzwmo.b[18][0];++cov_mv8zrzwmo.s[116];emitter.emit('error',err);}else{++cov_mv8zrzwmo.b[18][1];++cov_mv8zrzwmo.s[117];emitter.emit('results',gradingResult);}});++cov_mv8zrzwmo.s[118];return emitter;}}/**
 * Returns the path to the directory where the grading job files should be
 * written to while running in development (local) mode.
 *
 * If we're running natively, this should return $HOME/.pl_ag_jobs/job_<jobId>.
 * If we're running in Docker, this should return /jobs.
 *
 * On Windows, we use $USERPROFILE instead of $HOME.
 */function getDevJobDirectory(jobId){++cov_mv8zrzwmo.f[33];++cov_mv8zrzwmo.s[119];if(process.env.HOST_JOBS_DIR){++cov_mv8zrzwmo.b[19][0];++cov_mv8zrzwmo.s[120];// We're probably running in Docker
return path.join('/jobs',`job_${jobId}`);}else{++cov_mv8zrzwmo.b[19][1];++cov_mv8zrzwmo.s[121];// We're probably running natively
if(process.env.JOBS_DIR){++cov_mv8zrzwmo.b[20][0];++cov_mv8zrzwmo.s[122];// The user wants to use a custom jobs dir
return process.env.JOBS_DIR;}else{++cov_mv8zrzwmo.b[20][1];++cov_mv8zrzwmo.s[123];return path.resolve(path.join(os.homedir(),'.pljobs',`job_${jobId}`));}}}/**
 * Returns the directory that should be mounted to the grading container as
 * /grade while running in development (local) mode.
 *
 * If we're running natively, this should simply return getDevJobDirectory(...).
 * If we're running in Docker, this should return $HOST_JOBS_DIR/job_<jobId>.
 */function getDevHostJobDirectory(jobId){++cov_mv8zrzwmo.f[34];++cov_mv8zrzwmo.s[124];if(process.env.HOST_JOBS_DIR){++cov_mv8zrzwmo.b[21][0];++cov_mv8zrzwmo.s[125];// We're probably running in Docker
return path.resolve(path.join(process.env.HOST_JOBS_DIR,`job_${jobId}`));}else{++cov_mv8zrzwmo.b[21][1];++cov_mv8zrzwmo.s[126];// We're probably running natively
return getDevJobDirectory(jobId);}}++cov_mv8zrzwmo.s[127];module.exports=Grader;