var cov_m9ej3zxyc=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/file-paths.js',hash='e36ca4b35e795c1b5352c14b88c49678c7e2788e',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/file-paths.js',statementMap:{'0':{start:{line:1,column:10},end:{line:1,column:37}},'1':{start:{line:2,column:9},end:{line:2,column:22}},'2':{start:{line:3,column:11},end:{line:3,column:26}},'3':{start:{line:5,column:12},end:{line:5,column:30}},'4':{start:{line:6,column:13},end:{line:6,column:32}},'5':{start:{line:7,column:12},end:{line:7,column:30}},'6':{start:{line:8,column:16},end:{line:8,column:39}},'7':{start:{line:10,column:10},end:{line:10,column:44}},'8':{start:{line:12,column:0},end:{line:12,column:20}},'9':{start:{line:24,column:0},end:{line:92,column:2}},'10':{start:{line:25,column:4},end:{line:25,column:61}},'11':{start:{line:26,column:19},end:{line:26,column:72}},'12':{start:{line:27,column:19},end:{line:27,column:48}},'13':{start:{line:28,column:4},end:{line:30,column:5}},'14':{start:{line:29,column:8},end:{line:29,column:79}},'15':{start:{line:31,column:4},end:{line:91,column:7}},'16':{start:{line:32,column:8},end:{line:90,column:9}},'17':{start:{line:34,column:12},end:{line:86,column:13}},'18':{start:{line:36,column:29},end:{line:39,column:17}},'19':{start:{line:40,column:16},end:{line:53,column:19}},'20':{start:{line:41,column:20},end:{line:41,column:51}},'21':{start:{line:41,column:44},end:{line:41,column:51}},'22':{start:{line:42,column:20},end:{line:47,column:21}},'23':{start:{line:43,column:24},end:{line:46,column:124}},'24':{start:{line:48,column:43},end:{line:48,column:57}},'25':{start:{line:49,column:20},end:{line:52,column:39}},'26':{start:{line:50,column:24},end:{line:50,column:55}},'27':{start:{line:50,column:48},end:{line:50,column:55}},'28':{start:{line:51,column:24},end:{line:51,column:78}},'29':{start:{line:56,column:39},end:{line:59,column:17}},'30':{start:{line:60,column:16},end:{line:85,column:17}},'31':{start:{line:62,column:41},end:{line:62,column:83}},'32':{start:{line:63,column:41},end:{line:63,column:76}},'33':{start:{line:64,column:20},end:{line:72,column:23}},'34':{start:{line:65,column:24},end:{line:71,column:25}},'35':{start:{line:67,column:28},end:{line:67,column:116}},'36':{start:{line:70,column:28},end:{line:70,column:92}},'37':{start:{line:74,column:42},end:{line:74,column:84}},'38':{start:{line:75,column:46},end:{line:75,column:100}},'39':{start:{line:76,column:20},end:{line:84,column:23}},'40':{start:{line:77,column:24},end:{line:83,column:25}},'41':{start:{line:79,column:28},end:{line:79,column:115}},'42':{start:{line:82,column:28},end:{line:82,column:116}},'43':{start:{line:89,column:12},end:{line:89,column:64}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:24,column:34},end:{line:24,column:35}},loc:{start:{line:24,column:116},end:{line:92,column:1}},line:24},'1':{name:'(anonymous_1)',decl:{start:{line:31,column:22},end:{line:31,column:23}},loc:{start:{line:31,column:43},end:{line:91,column:5}},line:31},'2':{name:'(anonymous_2)',decl:{start:{line:40,column:69},end:{line:40,column:70}},loc:{start:{line:40,column:91},end:{line:53,column:17}},line:40},'3':{name:'(anonymous_3)',decl:{start:{line:49,column:127},end:{line:49,column:128}},loc:{start:{line:49,column:180},end:{line:52,column:21}},line:49},'4':{name:'(anonymous_4)',decl:{start:{line:64,column:44},end:{line:64,column:45}},loc:{start:{line:64,column:65},end:{line:72,column:21}},line:64},'5':{name:'(anonymous_5)',decl:{start:{line:76,column:49},end:{line:76,column:50}},loc:{start:{line:76,column:70},end:{line:84,column:21}},line:76}},branchMap:{'0':{loc:{start:{line:25,column:17},end:{line:25,column:60}},type:'cond-expr',locations:[{start:{line:25,column:46},end:{line:25,column:47}},{start:{line:25,column:50},end:{line:25,column:60}}],line:25},'1':{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:'if',locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},'2':{loc:{start:{line:32,column:8},end:{line:90,column:9}},type:'if',locations:[{start:{line:32,column:8},end:{line:90,column:9}},{start:{line:32,column:8},end:{line:90,column:9}}],line:32},'3':{loc:{start:{line:34,column:12},end:{line:86,column:13}},type:'if',locations:[{start:{line:34,column:12},end:{line:86,column:13}},{start:{line:34,column:12},end:{line:86,column:13}}],line:34},'4':{loc:{start:{line:41,column:20},end:{line:41,column:51}},type:'if',locations:[{start:{line:41,column:20},end:{line:41,column:51}},{start:{line:41,column:20},end:{line:41,column:51}}],line:41},'5':{loc:{start:{line:42,column:20},end:{line:47,column:21}},type:'if',locations:[{start:{line:42,column:20},end:{line:47,column:21}},{start:{line:42,column:20},end:{line:47,column:21}}],line:42},'6':{loc:{start:{line:50,column:24},end:{line:50,column:55}},type:'if',locations:[{start:{line:50,column:24},end:{line:50,column:55}},{start:{line:50,column:24},end:{line:50,column:55}}],line:50},'7':{loc:{start:{line:60,column:16},end:{line:85,column:17}},type:'if',locations:[{start:{line:60,column:16},end:{line:85,column:17}},{start:{line:60,column:16},end:{line:85,column:17}}],line:60},'8':{loc:{start:{line:65,column:24},end:{line:71,column:25}},type:'if',locations:[{start:{line:65,column:24},end:{line:71,column:25}},{start:{line:65,column:24},end:{line:71,column:25}}],line:65},'9':{loc:{start:{line:77,column:24},end:{line:83,column:25}},type:'if',locations:[{start:{line:77,column:24},end:{line:83,column:25}},{start:{line:77,column:24},end:{line:83,column:25}}],line:77}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var ERR=(++cov_m9ej3zxyc.s[0],require('async-stacktrace'));var fs=(++cov_m9ej3zxyc.s[1],require('fs'));var path=(++cov_m9ej3zxyc.s[2],require('path'));var error=(++cov_m9ej3zxyc.s[3],require('./error'));var config=(++cov_m9ej3zxyc.s[4],require('./config'));var sqldb=(++cov_m9ej3zxyc.s[5],require('./sqldb'));var sqlLoader=(++cov_m9ej3zxyc.s[6],require('./sql-loader'));var sql=(++cov_m9ej3zxyc.s[7],sqlLoader.loadSqlEquiv(__filename));++cov_m9ej3zxyc.s[8];module.exports={};/* returns (fullPath, effectiveFilename, rootPath)

   fullPath is the full path (including filename) of the file to load

   (effectiveFilename, rootPath) are equivalent data broken out so that
       fullPath = effectiveFilename + '/' + rootPath
   These can by used like:
       res.sendFile(effectiveFilename, {root: rootPath});
   for safety.
*/++cov_m9ej3zxyc.s[9];module.exports.questionFilePath=function(filename,questionDirectory,coursePath,question,callback,nTemplates){++cov_m9ej3zxyc.f[0];++cov_m9ej3zxyc.s[10];nTemplates=nTemplates===undefined?(++cov_m9ej3zxyc.b[0][0],0):(++cov_m9ej3zxyc.b[0][1],nTemplates);var rootPath=(++cov_m9ej3zxyc.s[11],path.join(coursePath,'questions',questionDirectory));var fullPath=(++cov_m9ej3zxyc.s[12],path.join(rootPath,filename));++cov_m9ej3zxyc.s[13];if(nTemplates>10){++cov_m9ej3zxyc.b[1][0];++cov_m9ej3zxyc.s[14];return callback(new Error('Too-long template recursion: '+rootPath));}else{++cov_m9ej3zxyc.b[1][1];}++cov_m9ej3zxyc.s[15];fs.stat(fullPath,function(err,_stat){++cov_m9ej3zxyc.f[1];++cov_m9ej3zxyc.s[16];if(err){++cov_m9ej3zxyc.b[2][0];++cov_m9ej3zxyc.s[17];// couldn't find the file
if(question.template_directory){++cov_m9ej3zxyc.b[3][0];// have a template, try it
var params=(++cov_m9ej3zxyc.s[18],{course_id:question.course_id,directory:question.template_directory});++cov_m9ej3zxyc.s[19];sqldb.queryZeroOrOneRow(sql.select_question,params,function(err,result){++cov_m9ej3zxyc.f[2];++cov_m9ej3zxyc.s[20];if(ERR(err,callback)){++cov_m9ej3zxyc.b[4][0];++cov_m9ej3zxyc.s[21];return;}else{++cov_m9ej3zxyc.b[4][1];}++cov_m9ej3zxyc.s[22];if(result.rowCount==0){++cov_m9ej3zxyc.b[5][0];++cov_m9ej3zxyc.s[23];return callback(error.make(500,'Could not find template question "'+question.template_directory+'" from question "'+question.directory+'"',{sql:sql.select_question,params:params}));}else{++cov_m9ej3zxyc.b[5][1];}var templateQuestion=(++cov_m9ej3zxyc.s[24],result.rows[0]);++cov_m9ej3zxyc.s[25];return module.exports.questionFilePath(filename,templateQuestion.directory,coursePath,templateQuestion,function(err,fullPath,effectiveFilename,rootPath){++cov_m9ej3zxyc.f[3];++cov_m9ej3zxyc.s[26];if(ERR(err,callback)){++cov_m9ej3zxyc.b[6][0];++cov_m9ej3zxyc.s[27];return;}else{++cov_m9ej3zxyc.b[6][1];}++cov_m9ej3zxyc.s[28];callback(null,fullPath,effectiveFilename,rootPath);},nTemplates+1);});}else{++cov_m9ej3zxyc.b[3][1];// no template, try default files
var filenameToSuffix=(++cov_m9ej3zxyc.s[29],{'client.js':'Client.js','server.js':'Server.js'});++cov_m9ej3zxyc.s[30];if(filenameToSuffix[filename]===undefined){++cov_m9ej3zxyc.b[7][0];// no default for this file type, so try clientFilesCourse
let rootPathCourse=(++cov_m9ej3zxyc.s[31],path.join(coursePath,'clientFilesCourse'));let fullPathCourse=(++cov_m9ej3zxyc.s[32],path.join(rootPathCourse,filename));++cov_m9ej3zxyc.s[33];fs.stat(fullPathCourse,function(err,_stat){++cov_m9ej3zxyc.f[4];++cov_m9ej3zxyc.s[34];if(err){++cov_m9ej3zxyc.b[8][0];++cov_m9ej3zxyc.s[35];// file also wasn't in clientFilesCourse, give up
return callback(new Error('file not found at: '+fullPath+' or: '+fullPathCourse));}else{++cov_m9ej3zxyc.b[8][1];++cov_m9ej3zxyc.s[36];// found the file in clientFilesCourse
return callback(null,fullPathCourse,filename,rootPathCourse);}});}else{++cov_m9ej3zxyc.b[7][1];var defaultFilename=(++cov_m9ej3zxyc.s[37],question.type+filenameToSuffix[filename]);var fullDefaultFilePath=(++cov_m9ej3zxyc.s[38],path.join(config.questionDefaultsDir,defaultFilename));++cov_m9ej3zxyc.s[39];fs.stat(fullDefaultFilePath,function(err,_stat){++cov_m9ej3zxyc.f[5];++cov_m9ej3zxyc.s[40];if(err){++cov_m9ej3zxyc.b[9][0];++cov_m9ej3zxyc.s[41];// no default file, give up
return callback(error.makeWithData('file not found',{fullPath,fullDefaultFilePath}));}else{++cov_m9ej3zxyc.b[9][1];++cov_m9ej3zxyc.s[42];// found a default file
return callback(null,fullDefaultFilePath,defaultFilename,config.questionDefaultsDir);}});}}}else{++cov_m9ej3zxyc.b[2][1];++cov_m9ej3zxyc.s[43];// found the file
return callback(null,fullPath,filename,rootPath);}});};