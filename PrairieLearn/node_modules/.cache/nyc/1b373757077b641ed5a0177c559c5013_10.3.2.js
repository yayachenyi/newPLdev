var cov_1kqfru2l03=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/externalGraderCommon.js',hash='222f4fc0a674a34215e24570862244f5af6b76a9',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/externalGraderCommon.js',statementMap:{'0':{start:{line:1,column:10},end:{line:1,column:37}},'1':{start:{line:2,column:12},end:{line:2,column:28}},'2':{start:{line:3,column:9},end:{line:3,column:28}},'3':{start:{line:4,column:11},end:{line:4,column:26}},'4':{start:{line:6,column:13},end:{line:6,column:32}},'5':{start:{line:12,column:0},end:{line:14,column:2}},'6':{start:{line:13,column:4},end:{line:13,column:32}},'7':{start:{line:19,column:0},end:{line:147,column:2}},'8':{start:{line:20,column:4},end:{line:146,column:7}},'9':{start:{line:23,column:12},end:{line:26,column:15}},'10':{start:{line:25,column:16},end:{line:25,column:31}},'11':{start:{line:29,column:12},end:{line:32,column:15}},'12':{start:{line:30,column:16},end:{line:30,column:47}},'13':{start:{line:30,column:40},end:{line:30,column:47}},'14':{start:{line:31,column:16},end:{line:31,column:31}},'15':{start:{line:35,column:12},end:{line:38,column:15}},'16':{start:{line:36,column:16},end:{line:36,column:47}},'17':{start:{line:36,column:40},end:{line:36,column:47}},'18':{start:{line:37,column:16},end:{line:37,column:31}},'19':{start:{line:41,column:12},end:{line:44,column:15}},'20':{start:{line:42,column:16},end:{line:42,column:47}},'21':{start:{line:42,column:40},end:{line:42,column:47}},'22':{start:{line:43,column:16},end:{line:43,column:31}},'23':{start:{line:47,column:12},end:{line:50,column:15}},'24':{start:{line:48,column:14},end:{line:48,column:45}},'25':{start:{line:48,column:38},end:{line:48,column:45}},'26':{start:{line:49,column:14},end:{line:49,column:29}},'27':{start:{line:53,column:10},end:{line:56,column:11}},'28':{start:{line:54,column:12},end:{line:54,column:43}},'29':{start:{line:54,column:36},end:{line:54,column:43}},'30':{start:{line:55,column:12},end:{line:55,column:27}},'31':{start:{line:60,column:12},end:{line:74,column:13}},'32':{start:{line:61,column:16},end:{line:71,column:19}},'33':{start:{line:62,column:32},end:{line:62,column:81}},'34':{start:{line:63,column:33},end:{line:63,column:74}},'35':{start:{line:64,column:20},end:{line:67,column:23}},'36':{start:{line:65,column:24},end:{line:65,column:55}},'37':{start:{line:65,column:48},end:{line:65,column:55}},'38':{start:{line:66,column:24},end:{line:66,column:39}},'39':{start:{line:69,column:20},end:{line:69,column:51}},'40':{start:{line:69,column:44},end:{line:69,column:51}},'41':{start:{line:70,column:20},end:{line:70,column:35}},'42':{start:{line:73,column:16},end:{line:73,column:31}},'43':{start:{line:79,column:24},end:{line:79,column:59}},'44':{start:{line:80,column:25},end:{line:80,column:49}},'45':{start:{line:81,column:12},end:{line:84,column:15}},'46':{start:{line:82,column:16},end:{line:82,column:47}},'47':{start:{line:82,column:40},end:{line:82,column:47}},'48':{start:{line:83,column:16},end:{line:83,column:31}},'49':{start:{line:88,column:29},end:{line:88,column:93}},'50':{start:{line:89,column:12},end:{line:99,column:15}},'51':{start:{line:90,column:16},end:{line:98,column:17}},'52':{start:{line:91,column:20},end:{line:94,column:23}},'53':{start:{line:92,column:24},end:{line:92,column:55}},'54':{start:{line:92,column:48},end:{line:92,column:55}},'55':{start:{line:93,column:24},end:{line:93,column:39}},'56':{start:{line:96,column:20},end:{line:96,column:114}},'57':{start:{line:97,column:20},end:{line:97,column:35}},'58':{start:{line:102,column:12},end:{line:120,column:13}},'59':{start:{line:103,column:16},end:{line:117,column:19}},'60':{start:{line:104,column:20},end:{line:106,column:21}},'61':{start:{line:105,column:24},end:{line:105,column:90}},'62':{start:{line:107,column:20},end:{line:109,column:21}},'63':{start:{line:108,column:24},end:{line:108,column:94}},'64':{start:{line:112,column:42},end:{line:112,column:88}},'65':{start:{line:113,column:20},end:{line:113,column:98}},'66':{start:{line:115,column:20},end:{line:115,column:51}},'67':{start:{line:115,column:44},end:{line:115,column:51}},'68':{start:{line:116,column:20},end:{line:116,column:35}},'69':{start:{line:119,column:16},end:{line:119,column:31}},'70':{start:{line:124,column:25},end:{line:136,column:13}},'71':{start:{line:137,column:12},end:{line:137,column:78}},'72':{start:{line:140,column:8},end:{line:142,column:9}},'73':{start:{line:141,column:12},end:{line:141,column:59}},'74':{start:{line:144,column:8},end:{line:144,column:50}},'75':{start:{line:145,column:8},end:{line:145,column:23}},'76':{start:{line:157,column:0},end:{line:202,column:2}},'77':{start:{line:158,column:15},end:{line:158,column:22}},'78':{start:{line:160,column:4},end:{line:166,column:5}},'79':{start:{line:161,column:8},end:{line:165,column:9}},'80':{start:{line:162,column:12},end:{line:162,column:39}},'81':{start:{line:164,column:12},end:{line:164,column:102}},'82':{start:{line:168,column:4},end:{line:179,column:5}},'83':{start:{line:169,column:8},end:{line:178,column:10}},'84':{start:{line:181,column:4},end:{line:183,column:5}},'85':{start:{line:182,column:8},end:{line:182,column:110}},'86':{start:{line:185,column:16},end:{line:185,column:19}},'87':{start:{line:186,column:4},end:{line:190,column:5}},'88':{start:{line:187,column:8},end:{line:187,column:35}},'89':{start:{line:189,column:8},end:{line:189,column:109}},'90':{start:{line:192,column:4},end:{line:201,column:6}},'91':{start:{line:205,column:4},end:{line:217,column:6}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:12,column:33},end:{line:12,column:34}},loc:{start:{line:12,column:49},end:{line:14,column:1}},line:12},'1':{name:'(anonymous_1)',decl:{start:{line:19,column:32},end:{line:19,column:33}},loc:{start:{line:19,column:95},end:{line:147,column:1}},line:19},'2':{name:'(anonymous_2)',decl:{start:{line:21,column:8},end:{line:21,column:9}},loc:{start:{line:21,column:22},end:{line:27,column:9}},line:21},'3':{name:'(anonymous_3)',decl:{start:{line:23,column:27},end:{line:23,column:28}},loc:{start:{line:23,column:33},end:{line:26,column:13}},line:23},'4':{name:'(anonymous_4)',decl:{start:{line:28,column:8},end:{line:28,column:9}},loc:{start:{line:28,column:22},end:{line:33,column:9}},line:28},'5':{name:'(anonymous_5)',decl:{start:{line:29,column:27},end:{line:29,column:28}},loc:{start:{line:29,column:36},end:{line:32,column:13}},line:29},'6':{name:'(anonymous_6)',decl:{start:{line:34,column:8},end:{line:34,column:9}},loc:{start:{line:34,column:22},end:{line:39,column:9}},line:34},'7':{name:'(anonymous_7)',decl:{start:{line:35,column:58},end:{line:35,column:59}},loc:{start:{line:35,column:67},end:{line:38,column:13}},line:35},'8':{name:'(anonymous_8)',decl:{start:{line:40,column:8},end:{line:40,column:9}},loc:{start:{line:40,column:22},end:{line:45,column:9}},line:40},'9':{name:'(anonymous_9)',decl:{start:{line:41,column:46},end:{line:41,column:47}},loc:{start:{line:41,column:55},end:{line:44,column:13}},line:41},'10':{name:'(anonymous_10)',decl:{start:{line:46,column:8},end:{line:46,column:9}},loc:{start:{line:46,column:22},end:{line:51,column:9}},line:46},'11':{name:'(anonymous_11)',decl:{start:{line:47,column:48},end:{line:47,column:49}},loc:{start:{line:47,column:57},end:{line:50,column:13}},line:47},'12':{name:'(anonymous_12)',decl:{start:{line:52,column:8},end:{line:52,column:9}},loc:{start:{line:52,column:22},end:{line:57,column:9}},line:52},'13':{name:'(anonymous_13)',decl:{start:{line:53,column:43},end:{line:53,column:44}},loc:{start:{line:53,column:52},end:{line:56,column:9}},line:53},'14':{name:'(anonymous_14)',decl:{start:{line:58,column:8},end:{line:58,column:9}},loc:{start:{line:58,column:22},end:{line:75,column:9}},line:58},'15':{name:'(anonymous_15)',decl:{start:{line:61,column:60},end:{line:61,column:61}},loc:{start:{line:61,column:80},end:{line:68,column:17}},line:61},'16':{name:'(anonymous_16)',decl:{start:{line:64,column:39},end:{line:64,column:40}},loc:{start:{line:64,column:48},end:{line:67,column:21}},line:64},'17':{name:'(anonymous_17)',decl:{start:{line:68,column:19},end:{line:68,column:20}},loc:{start:{line:68,column:28},end:{line:71,column:17}},line:68},'18':{name:'(anonymous_18)',decl:{start:{line:76,column:8},end:{line:76,column:9}},loc:{start:{line:76,column:22},end:{line:85,column:9}},line:76},'19':{name:'(anonymous_19)',decl:{start:{line:81,column:31},end:{line:81,column:32}},loc:{start:{line:81,column:40},end:{line:84,column:13}},line:81},'20':{name:'(anonymous_20)',decl:{start:{line:86,column:8},end:{line:86,column:9}},loc:{start:{line:86,column:22},end:{line:100,column:9}},line:86},'21':{name:'(anonymous_21)',decl:{start:{line:89,column:51},end:{line:89,column:52}},loc:{start:{line:89,column:60},end:{line:99,column:13}},line:89},'22':{name:'(anonymous_22)',decl:{start:{line:91,column:63},end:{line:91,column:64}},loc:{start:{line:91,column:72},end:{line:94,column:21}},line:91},'23':{name:'(anonymous_23)',decl:{start:{line:101,column:8},end:{line:101,column:9}},loc:{start:{line:101,column:22},end:{line:121,column:9}},line:101},'24':{name:'(anonymous_24)',decl:{start:{line:103,column:63},end:{line:103,column:64}},loc:{start:{line:103,column:83},end:{line:114,column:17}},line:103},'25':{name:'(anonymous_25)',decl:{start:{line:114,column:19},end:{line:114,column:20}},loc:{start:{line:114,column:33},end:{line:117,column:17}},line:114},'26':{name:'(anonymous_26)',decl:{start:{line:122,column:8},end:{line:122,column:9}},loc:{start:{line:122,column:22},end:{line:138,column:9}},line:122},'27':{name:'(anonymous_27)',decl:{start:{line:139,column:7},end:{line:139,column:8}},loc:{start:{line:139,column:16},end:{line:146,column:5}},line:139},'28':{name:'(anonymous_28)',decl:{start:{line:157,column:35},end:{line:157,column:36}},loc:{start:{line:157,column:60},end:{line:202,column:1}},line:157},'29':{name:'makeGradingFailureWithMessage',decl:{start:{line:204,column:9},end:{line:204,column:38}},loc:{start:{line:204,column:61},end:{line:218,column:1}},line:204}},branchMap:{'0':{loc:{start:{line:30,column:16},end:{line:30,column:47}},type:'if',locations:[{start:{line:30,column:16},end:{line:30,column:47}},{start:{line:30,column:16},end:{line:30,column:47}}],line:30},'1':{loc:{start:{line:36,column:16},end:{line:36,column:47}},type:'if',locations:[{start:{line:36,column:16},end:{line:36,column:47}},{start:{line:36,column:16},end:{line:36,column:47}}],line:36},'2':{loc:{start:{line:42,column:16},end:{line:42,column:47}},type:'if',locations:[{start:{line:42,column:16},end:{line:42,column:47}},{start:{line:42,column:16},end:{line:42,column:47}}],line:42},'3':{loc:{start:{line:48,column:14},end:{line:48,column:45}},type:'if',locations:[{start:{line:48,column:14},end:{line:48,column:45}},{start:{line:48,column:14},end:{line:48,column:45}}],line:48},'4':{loc:{start:{line:54,column:12},end:{line:54,column:43}},type:'if',locations:[{start:{line:54,column:12},end:{line:54,column:43}},{start:{line:54,column:12},end:{line:54,column:43}}],line:54},'5':{loc:{start:{line:60,column:12},end:{line:74,column:13}},type:'if',locations:[{start:{line:60,column:12},end:{line:74,column:13}},{start:{line:60,column:12},end:{line:74,column:13}}],line:60},'6':{loc:{start:{line:65,column:24},end:{line:65,column:55}},type:'if',locations:[{start:{line:65,column:24},end:{line:65,column:55}},{start:{line:65,column:24},end:{line:65,column:55}}],line:65},'7':{loc:{start:{line:69,column:20},end:{line:69,column:51}},type:'if',locations:[{start:{line:69,column:20},end:{line:69,column:51}},{start:{line:69,column:20},end:{line:69,column:51}}],line:69},'8':{loc:{start:{line:82,column:16},end:{line:82,column:47}},type:'if',locations:[{start:{line:82,column:16},end:{line:82,column:47}},{start:{line:82,column:16},end:{line:82,column:47}}],line:82},'9':{loc:{start:{line:90,column:16},end:{line:98,column:17}},type:'if',locations:[{start:{line:90,column:16},end:{line:98,column:17}},{start:{line:90,column:16},end:{line:98,column:17}}],line:90},'10':{loc:{start:{line:92,column:24},end:{line:92,column:55}},type:'if',locations:[{start:{line:92,column:24},end:{line:92,column:55}},{start:{line:92,column:24},end:{line:92,column:55}}],line:92},'11':{loc:{start:{line:102,column:12},end:{line:120,column:13}},type:'if',locations:[{start:{line:102,column:12},end:{line:120,column:13}},{start:{line:102,column:12},end:{line:120,column:13}}],line:102},'12':{loc:{start:{line:104,column:20},end:{line:106,column:21}},type:'if',locations:[{start:{line:104,column:20},end:{line:106,column:21}},{start:{line:104,column:20},end:{line:106,column:21}}],line:104},'13':{loc:{start:{line:107,column:20},end:{line:109,column:21}},type:'if',locations:[{start:{line:107,column:20},end:{line:109,column:21}},{start:{line:107,column:20},end:{line:109,column:21}}],line:107},'14':{loc:{start:{line:115,column:20},end:{line:115,column:51}},type:'if',locations:[{start:{line:115,column:20},end:{line:115,column:51}},{start:{line:115,column:20},end:{line:115,column:51}}],line:115},'15':{loc:{start:{line:129,column:32},end:{line:129,column:100}},type:'cond-expr',locations:[{start:{line:129,column:70},end:{line:129,column:72}},{start:{line:129,column:75},end:{line:129,column:100}}],line:129},'16':{loc:{start:{line:130,column:23},end:{line:130,column:72}},type:'cond-expr',locations:[{start:{line:130,column:52},end:{line:130,column:53}},{start:{line:130,column:56},end:{line:130,column:72}}],line:130},'17':{loc:{start:{line:131,column:26},end:{line:131,column:82}},type:'cond-expr',locations:[{start:{line:131,column:58},end:{line:131,column:60}},{start:{line:131,column:63},end:{line:131,column:82}}],line:131},'18':{loc:{start:{line:133,column:25},end:{line:133,column:46}},type:'binary-expr',locations:[{start:{line:133,column:25},end:{line:133,column:40}},{start:{line:133,column:44},end:{line:133,column:46}}],line:133},'19':{loc:{start:{line:140,column:8},end:{line:142,column:9}},type:'if',locations:[{start:{line:140,column:8},end:{line:142,column:9}},{start:{line:140,column:8},end:{line:142,column:9}}],line:140},'20':{loc:{start:{line:160,column:4},end:{line:166,column:5}},type:'if',locations:[{start:{line:160,column:4},end:{line:166,column:5}},{start:{line:160,column:4},end:{line:166,column:5}}],line:160},'21':{loc:{start:{line:160,column:8},end:{line:160,column:63}},type:'binary-expr',locations:[{start:{line:160,column:8},end:{line:160,column:35}},{start:{line:160,column:39},end:{line:160,column:63}}],line:160},'22':{loc:{start:{line:168,column:4},end:{line:179,column:5}},type:'if',locations:[{start:{line:168,column:4},end:{line:179,column:5}},{start:{line:168,column:4},end:{line:179,column:5}}],line:168},'23':{loc:{start:{line:172,column:30},end:{line:172,column:56}},type:'binary-expr',locations:[{start:{line:172,column:30},end:{line:172,column:48}},{start:{line:172,column:52},end:{line:172,column:56}}],line:172},'24':{loc:{start:{line:173,column:27},end:{line:173,column:50}},type:'binary-expr',locations:[{start:{line:173,column:27},end:{line:173,column:42}},{start:{line:173,column:46},end:{line:173,column:50}}],line:173},'25':{loc:{start:{line:174,column:25},end:{line:174,column:46}},type:'binary-expr',locations:[{start:{line:174,column:25},end:{line:174,column:38}},{start:{line:174,column:42},end:{line:174,column:46}}],line:174},'26':{loc:{start:{line:181,column:4},end:{line:183,column:5}},type:'if',locations:[{start:{line:181,column:4},end:{line:183,column:5}},{start:{line:181,column:4},end:{line:183,column:5}}],line:181},'27':{loc:{start:{line:186,column:4},end:{line:190,column:5}},type:'if',locations:[{start:{line:186,column:4},end:{line:190,column:5}},{start:{line:186,column:4},end:{line:190,column:5}}],line:186},'28':{loc:{start:{line:186,column:8},end:{line:186,column:83}},type:'binary-expr',locations:[{start:{line:186,column:8},end:{line:186,column:46}},{start:{line:186,column:50},end:{line:186,column:83}}],line:186},'29':{loc:{start:{line:195,column:26},end:{line:195,column:52}},type:'binary-expr',locations:[{start:{line:195,column:26},end:{line:195,column:44}},{start:{line:195,column:48},end:{line:195,column:52}}],line:195},'30':{loc:{start:{line:196,column:23},end:{line:196,column:46}},type:'binary-expr',locations:[{start:{line:196,column:23},end:{line:196,column:38}},{start:{line:196,column:42},end:{line:196,column:46}}],line:196},'31':{loc:{start:{line:197,column:21},end:{line:197,column:42}},type:'binary-expr',locations:[{start:{line:197,column:21},end:{line:197,column:34}},{start:{line:197,column:38},end:{line:197,column:42}}],line:197},'32':{loc:{start:{line:208,column:26},end:{line:208,column:62}},type:'binary-expr',locations:[{start:{line:208,column:27},end:{line:208,column:31}},{start:{line:208,column:35},end:{line:208,column:53}},{start:{line:208,column:58},end:{line:208,column:62}}],line:208},'33':{loc:{start:{line:209,column:23},end:{line:209,column:56}},type:'binary-expr',locations:[{start:{line:209,column:24},end:{line:209,column:28}},{start:{line:209,column:32},end:{line:209,column:47}},{start:{line:209,column:52},end:{line:209,column:56}}],line:209},'34':{loc:{start:{line:210,column:21},end:{line:210,column:52}},type:'binary-expr',locations:[{start:{line:210,column:22},end:{line:210,column:26}},{start:{line:210,column:30},end:{line:210,column:43}},{start:{line:210,column:48},end:{line:210,column:52}}],line:210}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0,'87':0,'88':0,'89':0,'90':0,'91':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0],'16':[0,0],'17':[0,0],'18':[0,0],'19':[0,0],'20':[0,0],'21':[0,0],'22':[0,0],'23':[0,0],'24':[0,0],'25':[0,0],'26':[0,0],'27':[0,0],'28':[0,0],'29':[0,0],'30':[0,0],'31':[0,0],'32':[0,0,0],'33':[0,0,0],'34':[0,0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var ERR=(++cov_1kqfru2l03.s[0],require('async-stacktrace'));var async=(++cov_1kqfru2l03.s[1],require('async'));var fs=(++cov_1kqfru2l03.s[2],require('fs-extra'));var path=(++cov_1kqfru2l03.s[3],require('path'));var logger=(++cov_1kqfru2l03.s[4],require('./logger'));/**
 * Returns the directory where job files should be written to while running
 * with AWS infrastructure.
 */++cov_1kqfru2l03.s[5];module.exports.getJobDirectory=function(jobId){++cov_1kqfru2l03.f[0];++cov_1kqfru2l03.s[6];return`/jobs/job_${jobId}`;};/**
 * Constructs a directory of files to be used for grading.
 */++cov_1kqfru2l03.s[7];module.exports.buildDirectory=function(dir,submission,variant,question,course,callback){++cov_1kqfru2l03.f[1];++cov_1kqfru2l03.s[8];async.series([callback=>{++cov_1kqfru2l03.f[2];++cov_1kqfru2l03.s[9];// Attempt to remove existing directory first
fs.remove(dir,()=>{++cov_1kqfru2l03.f[3];++cov_1kqfru2l03.s[10];// Ignore error for now
callback(null);});},callback=>{++cov_1kqfru2l03.f[4];++cov_1kqfru2l03.s[11];fs.mkdirs(dir,err=>{++cov_1kqfru2l03.f[5];++cov_1kqfru2l03.s[12];if(ERR(err,callback)){++cov_1kqfru2l03.b[0][0];++cov_1kqfru2l03.s[13];return;}else{++cov_1kqfru2l03.b[0][1];}++cov_1kqfru2l03.s[14];callback(null);});},callback=>{++cov_1kqfru2l03.f[6];++cov_1kqfru2l03.s[15];fs.mkdir(path.join(dir,'serverFilesCourse'),err=>{++cov_1kqfru2l03.f[7];++cov_1kqfru2l03.s[16];if(ERR(err,callback)){++cov_1kqfru2l03.b[1][0];++cov_1kqfru2l03.s[17];return;}else{++cov_1kqfru2l03.b[1][1];}++cov_1kqfru2l03.s[18];callback(null);});},callback=>{++cov_1kqfru2l03.f[8];++cov_1kqfru2l03.s[19];fs.mkdir(path.join(dir,'tests'),err=>{++cov_1kqfru2l03.f[9];++cov_1kqfru2l03.s[20];if(ERR(err,callback)){++cov_1kqfru2l03.b[2][0];++cov_1kqfru2l03.s[21];return;}else{++cov_1kqfru2l03.b[2][1];}++cov_1kqfru2l03.s[22];callback(null);});},callback=>{++cov_1kqfru2l03.f[10];++cov_1kqfru2l03.s[23];fs.mkdir(path.join(dir,'student'),err=>{++cov_1kqfru2l03.f[11];++cov_1kqfru2l03.s[24];if(ERR(err,callback)){++cov_1kqfru2l03.b[3][0];++cov_1kqfru2l03.s[25];return;}else{++cov_1kqfru2l03.b[3][1];}++cov_1kqfru2l03.s[26];callback(null);});},callback=>{++cov_1kqfru2l03.f[12];++cov_1kqfru2l03.s[27];fs.mkdir(path.join(dir,'data'),err=>{++cov_1kqfru2l03.f[13];++cov_1kqfru2l03.s[28];if(ERR(err,callback)){++cov_1kqfru2l03.b[4][0];++cov_1kqfru2l03.s[29];return;}else{++cov_1kqfru2l03.b[4][1];}++cov_1kqfru2l03.s[30];callback(null);});},callback=>{++cov_1kqfru2l03.f[14];++cov_1kqfru2l03.s[31];// Copy all specified files/directories into serverFilesCourse/
if(question.external_grading_files){++cov_1kqfru2l03.b[5][0];++cov_1kqfru2l03.s[32];async.each(question.external_grading_files,(file,callback)=>{++cov_1kqfru2l03.f[15];const src=(++cov_1kqfru2l03.s[33],path.join(course.path,'serverFilesCourse',file));const dest=(++cov_1kqfru2l03.s[34],path.join(dir,'serverFilesCourse',file));++cov_1kqfru2l03.s[35];fs.copy(src,dest,err=>{++cov_1kqfru2l03.f[16];++cov_1kqfru2l03.s[36];if(ERR(err,callback)){++cov_1kqfru2l03.b[6][0];++cov_1kqfru2l03.s[37];return;}else{++cov_1kqfru2l03.b[6][1];}++cov_1kqfru2l03.s[38];callback(null);});},err=>{++cov_1kqfru2l03.f[17];++cov_1kqfru2l03.s[39];if(ERR(err,callback)){++cov_1kqfru2l03.b[7][0];++cov_1kqfru2l03.s[40];return;}else{++cov_1kqfru2l03.b[7][1];}++cov_1kqfru2l03.s[41];callback(null);});}else{++cov_1kqfru2l03.b[5][1];++cov_1kqfru2l03.s[42];callback(null);}},callback=>{++cov_1kqfru2l03.f[18];// This is temporary while /grade/shared is deprecated but still supported
// TODO remove this when we remove support for /grade/shared
const src=(++cov_1kqfru2l03.s[43],path.join(dir,'serverFilesCourse'));const dest=(++cov_1kqfru2l03.s[44],path.join(dir,'shared'));++cov_1kqfru2l03.s[45];fs.copy(src,dest,err=>{++cov_1kqfru2l03.f[19];++cov_1kqfru2l03.s[46];if(ERR(err,callback)){++cov_1kqfru2l03.b[8][0];++cov_1kqfru2l03.s[47];return;}else{++cov_1kqfru2l03.b[8][1];}++cov_1kqfru2l03.s[48];callback(null);});},callback=>{++cov_1kqfru2l03.f[20];// Tests might not be specified, only copy them if they exist
const testsDir=(++cov_1kqfru2l03.s[49],path.join(course.path,'questions',question.directory,'tests'));++cov_1kqfru2l03.s[50];fs.access(testsDir,fs.constants.R_OK,err=>{++cov_1kqfru2l03.f[21];++cov_1kqfru2l03.s[51];if(!err){++cov_1kqfru2l03.b[9][0];++cov_1kqfru2l03.s[52];fs.copy(testsDir,path.join(dir,'tests'),err=>{++cov_1kqfru2l03.f[22];++cov_1kqfru2l03.s[53];if(ERR(err,callback)){++cov_1kqfru2l03.b[10][0];++cov_1kqfru2l03.s[54];return;}else{++cov_1kqfru2l03.b[10][1];}++cov_1kqfru2l03.s[55];callback(null);});}else{++cov_1kqfru2l03.b[9][1];++cov_1kqfru2l03.s[56];logger.warn(`No tests directory found for ${question.qid}; maybe you meant to specify some?`);++cov_1kqfru2l03.s[57];callback(null);}});},callback=>{++cov_1kqfru2l03.f[23];++cov_1kqfru2l03.s[58];if(submission.submitted_answer._files){++cov_1kqfru2l03.b[11][0];++cov_1kqfru2l03.s[59];async.each(submission.submitted_answer._files,(file,callback)=>{++cov_1kqfru2l03.f[24];++cov_1kqfru2l03.s[60];if(!file.name){++cov_1kqfru2l03.b[12][0];++cov_1kqfru2l03.s[61];return callback(new Error('File was missing \'name\' property.'));}else{++cov_1kqfru2l03.b[12][1];}++cov_1kqfru2l03.s[62];if(!file.contents){++cov_1kqfru2l03.b[13][0];++cov_1kqfru2l03.s[63];return callback(new Error('File was missing \'contents\' property.'));}else{++cov_1kqfru2l03.b[13][1];}// Files are expected to be base-64 encoded
let decodedContents=(++cov_1kqfru2l03.s[64],new Buffer(file.contents,'base64').toString());++cov_1kqfru2l03.s[65];fs.writeFile(path.join(dir,'student',file.name),decodedContents,callback);},function(err){++cov_1kqfru2l03.f[25];++cov_1kqfru2l03.s[66];if(ERR(err,callback)){++cov_1kqfru2l03.b[14][0];++cov_1kqfru2l03.s[67];return;}else{++cov_1kqfru2l03.b[14][1];}++cov_1kqfru2l03.s[68];callback(null);});}else{++cov_1kqfru2l03.b[11][1];++cov_1kqfru2l03.s[69];callback(null);}},callback=>{++cov_1kqfru2l03.f[26];// This uses the same fields passed v3's server.grade functions
const data=(++cov_1kqfru2l03.s[70],{params:variant.params,correct_answers:variant.true_answer,submitted_answers:submission.submitted_answer,format_errors:submission.format_errors,partial_scores:submission.partial_scores==null?(++cov_1kqfru2l03.b[15][0],{}):(++cov_1kqfru2l03.b[15][1],submission.partial_scores),score:submission.score==null?(++cov_1kqfru2l03.b[16][0],0):(++cov_1kqfru2l03.b[16][1],submission.score),feedback:submission.feedback==null?(++cov_1kqfru2l03.b[17][0],{}):(++cov_1kqfru2l03.b[17][1],submission.feedback),variant_seed:parseInt(variant.variant_seed,36),options:(++cov_1kqfru2l03.b[18][0],variant.options)||(++cov_1kqfru2l03.b[18][1],{}),raw_submitted_answers:submission.raw_submitted_answer,gradable:submission.gradable});++cov_1kqfru2l03.s[71];fs.writeJSON(path.join(dir,'data','data.json'),data,callback);}],err=>{++cov_1kqfru2l03.f[27];++cov_1kqfru2l03.s[72];if(ERR(err,callback)){++cov_1kqfru2l03.b[19][0];++cov_1kqfru2l03.s[73];return logger.error(`Error setting up ${dir}`);}else{++cov_1kqfru2l03.b[19][1];}++cov_1kqfru2l03.s[74];logger.info(`Successfully set up ${dir}`);++cov_1kqfru2l03.s[75];callback(null);});};/**
* Generates an object that can be passed to assessment.processGradingResult.
* This function can be passed a parsed results object, or it can be passed a
* string or buffer to attempt to parse it and mark the grading job as failed when
* parsing fails.
*
* @param {Object|string|Buffer} data - The grading results
*/++cov_1kqfru2l03.s[76];module.exports.makeGradingResult=function(jobId,rawData){++cov_1kqfru2l03.f[28];let data=(++cov_1kqfru2l03.s[77],rawData);// Assume it's a valid JSON object if it's not a string or a buffer
++cov_1kqfru2l03.s[78];if((++cov_1kqfru2l03.b[21][0],typeof rawData==='string')||(++cov_1kqfru2l03.b[21][1],Buffer.isBuffer(rawData))){++cov_1kqfru2l03.b[20][0];++cov_1kqfru2l03.s[79];try{++cov_1kqfru2l03.s[80];data=JSON.parse(rawData);}catch(e){++cov_1kqfru2l03.s[81];return makeGradingFailureWithMessage(jobId,data,'Could not parse the grading results.');}}else{++cov_1kqfru2l03.b[20][1];}++cov_1kqfru2l03.s[82];if(!data.succeeded){++cov_1kqfru2l03.b[22][0];++cov_1kqfru2l03.s[83];return{gradingId:jobId,grading:{receivedTime:(++cov_1kqfru2l03.b[23][0],data.received_time)||(++cov_1kqfru2l03.b[23][1],null),startTime:(++cov_1kqfru2l03.b[24][0],data.start_time)||(++cov_1kqfru2l03.b[24][1],null),endTime:(++cov_1kqfru2l03.b[25][0],data.end_time)||(++cov_1kqfru2l03.b[25][1],null),score:0,feedback:data}};}else{++cov_1kqfru2l03.b[22][1];}++cov_1kqfru2l03.s[84];if(!data.results){++cov_1kqfru2l03.b[26][0];++cov_1kqfru2l03.s[85];return makeGradingFailureWithMessage(jobId,data,'results.json did not contain \'results\' object.');}else{++cov_1kqfru2l03.b[26][1];}let score=(++cov_1kqfru2l03.s[86],0.0);++cov_1kqfru2l03.s[87];if((++cov_1kqfru2l03.b[28][0],typeof data.results.score==='number')||(++cov_1kqfru2l03.b[28][1],!Number.isNaN(data.results.score))){++cov_1kqfru2l03.b[27][0];++cov_1kqfru2l03.s[88];score=data.results.score;}else{++cov_1kqfru2l03.b[27][1];++cov_1kqfru2l03.s[89];return makeGradingFailureWithMessage(jobId,data,`score "${data.results.score}" was not a number.`);}++cov_1kqfru2l03.s[90];return{gradingId:jobId,grading:{receivedTime:(++cov_1kqfru2l03.b[29][0],data.received_time)||(++cov_1kqfru2l03.b[29][1],null),startTime:(++cov_1kqfru2l03.b[30][0],data.start_time)||(++cov_1kqfru2l03.b[30][1],null),endTime:(++cov_1kqfru2l03.b[31][0],data.end_time)||(++cov_1kqfru2l03.b[31][1],null),score,feedback:data}};};function makeGradingFailureWithMessage(jobId,data,message){++cov_1kqfru2l03.f[29];++cov_1kqfru2l03.s[91];return{gradingId:jobId,grading:{receivedTime:(++cov_1kqfru2l03.b[32][0],data)&&(++cov_1kqfru2l03.b[32][1],data.received_time)||(++cov_1kqfru2l03.b[32][2],null),startTime:(++cov_1kqfru2l03.b[33][0],data)&&(++cov_1kqfru2l03.b[33][1],data.start_time)||(++cov_1kqfru2l03.b[33][2],null),endTime:(++cov_1kqfru2l03.b[34][0],data)&&(++cov_1kqfru2l03.b[34][1],data.end_time)||(++cov_1kqfru2l03.b[34][2],null),score:0,feedback:{succeeded:false,message}}};}