var cov_muhwcl7pb=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/csrf.js',hash='6171d6c5c76b053537f2ec2d8b0a8224160f40a8',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/lib/csrf.js',statementMap:{'0':{start:{line:1,column:8},end:{line:1,column:25}},'1':{start:{line:2,column:17},end:{line:2,column:49}},'2':{start:{line:4,column:0},end:{line:61,column:2}},'3':{start:{line:6,column:23},end:{line:6,column:43}},'4':{start:{line:7,column:25},end:{line:7,column:75}},'5':{start:{line:8,column:25},end:{line:8,column:51}},'6':{start:{line:9,column:26},end:{line:9,column:55}},'7':{start:{line:10,column:24},end:{line:10,column:69}},'8':{start:{line:11,column:20},end:{line:11,column:49}},'9':{start:{line:12,column:8},end:{line:12,column:21}},'10':{start:{line:16,column:8},end:{line:16,column:44}},'11':{start:{line:16,column:32},end:{line:16,column:44}},'12':{start:{line:17,column:8},end:{line:17,column:32}},'13':{start:{line:20,column:20},end:{line:20,column:60}},'14':{start:{line:21,column:8},end:{line:21,column:39}},'15':{start:{line:21,column:27},end:{line:21,column:39}},'16':{start:{line:22,column:29},end:{line:22,column:37}},'17':{start:{line:23,column:30},end:{line:23,column:38}},'18':{start:{line:24,column:30},end:{line:24,column:38}},'19':{start:{line:27,column:26},end:{line:27,column:65}},'20':{start:{line:28,column:29},end:{line:28,column:74}},'21':{start:{line:29,column:8},end:{line:29,column:59}},'22':{start:{line:29,column:47},end:{line:29,column:59}},'23':{start:{line:32,column:8},end:{line:42,column:9}},'24':{start:{line:34,column:12},end:{line:38,column:13}},'25':{start:{line:35,column:16},end:{line:35,column:54}},'26':{start:{line:37,column:16},end:{line:37,column:28}},'27':{start:{line:39,column:30},end:{line:39,column:90}},'28':{start:{line:40,column:30},end:{line:40,column:63}},'29':{start:{line:41,column:12},end:{line:41,column:58}},'30':{start:{line:41,column:46},end:{line:41,column:58}},'31':{start:{line:46,column:8},end:{line:51,column:9}},'32':{start:{line:47,column:32},end:{line:47,column:89}},'33':{start:{line:48,column:12},end:{line:48,column:50}},'34':{start:{line:50,column:12},end:{line:50,column:24}},'35':{start:{line:52,column:8},end:{line:52,column:25}},'36':{start:{line:56,column:24},end:{line:56,column:70}},'37':{start:{line:57,column:8},end:{line:57,column:44}},'38':{start:{line:57,column:31},end:{line:57,column:44}},'39':{start:{line:58,column:8},end:{line:58,column:54}},'40':{start:{line:58,column:41},end:{line:58,column:54}},'41':{start:{line:59,column:8},end:{line:59,column:20}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:5,column:19},end:{line:5,column:20}},loc:{start:{line:5,column:45},end:{line:13,column:5}},line:5},'1':{name:'(anonymous_1)',decl:{start:{line:15,column:20},end:{line:15,column:21}},loc:{start:{line:15,column:56},end:{line:53,column:5}},line:15},'2':{name:'(anonymous_2)',decl:{start:{line:55,column:16},end:{line:55,column:17}},loc:{start:{line:55,column:58},end:{line:60,column:5}},line:55}},branchMap:{'0':{loc:{start:{line:16,column:8},end:{line:16,column:44}},type:'if',locations:[{start:{line:16,column:8},end:{line:16,column:44}},{start:{line:16,column:8},end:{line:16,column:44}}],line:16},'1':{loc:{start:{line:17,column:18},end:{line:17,column:31}},type:'binary-expr',locations:[{start:{line:17,column:18},end:{line:17,column:25}},{start:{line:17,column:29},end:{line:17,column:31}}],line:17},'2':{loc:{start:{line:21,column:8},end:{line:21,column:39}},type:'if',locations:[{start:{line:21,column:8},end:{line:21,column:39}},{start:{line:21,column:8},end:{line:21,column:39}}],line:21},'3':{loc:{start:{line:29,column:8},end:{line:29,column:59}},type:'if',locations:[{start:{line:29,column:8},end:{line:29,column:59}},{start:{line:29,column:8},end:{line:29,column:59}}],line:29},'4':{loc:{start:{line:32,column:8},end:{line:42,column:9}},type:'if',locations:[{start:{line:32,column:8},end:{line:42,column:9}},{start:{line:32,column:8},end:{line:42,column:9}}],line:32},'5':{loc:{start:{line:39,column:30},end:{line:39,column:90}},type:'cond-expr',locations:[{start:{line:39,column:49},end:{line:39,column:77}},{start:{line:39,column:80},end:{line:39,column:90}}],line:39},'6':{loc:{start:{line:41,column:12},end:{line:41,column:58}},type:'if',locations:[{start:{line:41,column:12},end:{line:41,column:58}},{start:{line:41,column:12},end:{line:41,column:58}}],line:41},'7':{loc:{start:{line:57,column:8},end:{line:57,column:44}},type:'if',locations:[{start:{line:57,column:8},end:{line:57,column:44}},{start:{line:57,column:8},end:{line:57,column:44}}],line:57},'8':{loc:{start:{line:58,column:8},end:{line:58,column:54}},type:'if',locations:[{start:{line:58,column:8},end:{line:58,column:54}},{start:{line:58,column:8},end:{line:58,column:54}}],line:58}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0},f:{'0':0,'1':0,'2':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var _=(++cov_muhwcl7pb.s[0],require('lodash'));var hmacSha256=(++cov_muhwcl7pb.s[1],require('crypto-js/hmac-sha256'));++cov_muhwcl7pb.s[2];module.exports={generateToken:function(data,secretKey){++cov_muhwcl7pb.f[0];var dataJSON=(++cov_muhwcl7pb.s[3],JSON.stringify(data));var dataString=(++cov_muhwcl7pb.s[4],Buffer.from(dataJSON,'utf8').toString('base64'));var dateString=(++cov_muhwcl7pb.s[5],new Date().toISOString());var checkString=(++cov_muhwcl7pb.s[6],dateString+'_'+dataString);var signature=(++cov_muhwcl7pb.s[7],hmacSha256(checkString,secretKey).toString());var token=(++cov_muhwcl7pb.s[8],signature+'_'+checkString);++cov_muhwcl7pb.s[9];return token;},getCheckedData:function(token,secretKey,options){++cov_muhwcl7pb.f[1];++cov_muhwcl7pb.s[10];if(!_.isString(token)){++cov_muhwcl7pb.b[0][0];++cov_muhwcl7pb.s[11];return null;}else{++cov_muhwcl7pb.b[0][1];}++cov_muhwcl7pb.s[12];options=(++cov_muhwcl7pb.b[1][0],options)||(++cov_muhwcl7pb.b[1][1],{});// break token apart into the three components
var match=(++cov_muhwcl7pb.s[13],token.match(/^([^_]+)_([^_]+)_([^_]+)$/));++cov_muhwcl7pb.s[14];if(match==null){++cov_muhwcl7pb.b[2][0];++cov_muhwcl7pb.s[15];return null;}else{++cov_muhwcl7pb.b[2][1];}var tokenSignature=(++cov_muhwcl7pb.s[16],match[1]);var tokenDateString=(++cov_muhwcl7pb.s[17],match[2]);var tokenDataString=(++cov_muhwcl7pb.s[18],match[3]);// check the signature
var checkString=(++cov_muhwcl7pb.s[19],tokenDateString+'_'+tokenDataString);var checkSignature=(++cov_muhwcl7pb.s[20],hmacSha256(checkString,secretKey).toString());++cov_muhwcl7pb.s[21];if(checkSignature!==tokenSignature){++cov_muhwcl7pb.b[3][0];++cov_muhwcl7pb.s[22];return null;}else{++cov_muhwcl7pb.b[3][1];}// check the age if we have the maxAge parameter
++cov_muhwcl7pb.s[23];if(options.maxAge!=null){++cov_muhwcl7pb.b[4][0];var tokenDate;++cov_muhwcl7pb.s[24];try{++cov_muhwcl7pb.s[25];tokenDate=new Date(tokenDateString);}catch(e){++cov_muhwcl7pb.s[26];return null;}var currentTime=(++cov_muhwcl7pb.s[27],options.req_date?(++cov_muhwcl7pb.b[5][0],Date.parse(options.req_date)):(++cov_muhwcl7pb.b[5][1],Date.now()));var elapsedTime=(++cov_muhwcl7pb.s[28],currentTime-tokenDate.getTime());++cov_muhwcl7pb.s[29];if(elapsedTime>options.maxAge){++cov_muhwcl7pb.b[6][0];++cov_muhwcl7pb.s[30];return null;}else{++cov_muhwcl7pb.b[6][1];}}else{++cov_muhwcl7pb.b[4][1];}// get the data
var tokenData;++cov_muhwcl7pb.s[31];try{var tokenDataJSON=(++cov_muhwcl7pb.s[32],Buffer.from(tokenDataString,'base64').toString('utf8'));++cov_muhwcl7pb.s[33];tokenData=JSON.parse(tokenDataJSON);}catch(e){++cov_muhwcl7pb.s[34];return null;}++cov_muhwcl7pb.s[35];return tokenData;},checkToken:function(token,data,secretKey,options){++cov_muhwcl7pb.f[2];var tokenData=(++cov_muhwcl7pb.s[36],this.getCheckedData(token,secretKey,options));++cov_muhwcl7pb.s[37];if(tokenData==null){++cov_muhwcl7pb.b[7][0];++cov_muhwcl7pb.s[38];return false;}else{++cov_muhwcl7pb.b[7][1];}++cov_muhwcl7pb.s[39];if(!_.isEqual(data,tokenData)){++cov_muhwcl7pb.b[8][0];++cov_muhwcl7pb.s[40];return false;}else{++cov_muhwcl7pb.b[8][1];}++cov_muhwcl7pb.s[41];return true;}};