var cov_2m26hkwnj2=function(){var path='/Users/fengyichen/pldev/newfolder/PrairieLearn/pages/instructorAssessments/instructorAssessments.js',hash='e6aeca61ed1cd71ae1612c0e4dc2f8d44c045e38',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/fengyichen/pldev/newfolder/PrairieLearn/pages/instructorAssessments/instructorAssessments.js',statementMap:{'0':{start:{line:1,column:10},end:{line:1,column:37}},'1':{start:{line:2,column:8},end:{line:2,column:25}},'2':{start:{line:3,column:19},end:{line:3,column:43}},'3':{start:{line:4,column:14},end:{line:4,column:32}},'4':{start:{line:5,column:13},end:{line:5,column:29}},'5':{start:{line:7,column:12},end:{line:7,column:38}},'6':{start:{line:8,column:16},end:{line:8,column:47}},'7':{start:{line:10,column:10},end:{line:10,column:44}},'8':{start:{line:12,column:18},end:{line:18,column:1}},'9':{start:{line:13,column:4},end:{line:17,column:33}},'10':{start:{line:20,column:0},end:{line:33,column:3}},'11':{start:{line:21,column:4},end:{line:21,column:53}},'12':{start:{line:22,column:17},end:{line:26,column:5}},'13':{start:{line:27,column:4},end:{line:32,column:7}},'14':{start:{line:28,column:8},end:{line:28,column:35}},'15':{start:{line:28,column:28},end:{line:28,column:35}},'16':{start:{line:30,column:8},end:{line:30,column:38}},'17':{start:{line:31,column:8},end:{line:31,column:68}},'18':{start:{line:35,column:0},end:{line:84,column:3}},'19':{start:{line:36,column:4},end:{line:83,column:5}},'20':{start:{line:37,column:21},end:{line:41,column:9}},'21':{start:{line:42,column:8},end:{line:80,column:11}},'22':{start:{line:43,column:12},end:{line:43,column:39}},'23':{start:{line:43,column:32},end:{line:43,column:39}},'24':{start:{line:44,column:34},end:{line:44,column:45}},'25':{start:{line:45,column:29},end:{line:49,column:75}},'26':{start:{line:50,column:26},end:{line:50,column:28}},'27':{start:{line:51,column:12},end:{line:73,column:15}},'28':{start:{line:52,column:29},end:{line:70,column:17}},'29':{start:{line:71,column:16},end:{line:71,column:66}},'30':{start:{line:72,column:16},end:{line:72,column:37}},'31':{start:{line:74,column:12},end:{line:74,column:45}},'32':{start:{line:75,column:12},end:{line:79,column:15}},'33':{start:{line:76,column:16},end:{line:76,column:66}},'34':{start:{line:76,column:25},end:{line:76,column:66}},'35':{start:{line:77,column:16},end:{line:77,column:52}},'36':{start:{line:78,column:16},end:{line:78,column:30}},'37':{start:{line:82,column:8},end:{line:82,column:68}},'38':{start:{line:86,column:0},end:{line:86,column:24}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:12,column:18},end:{line:12,column:19}},loc:{start:{line:12,column:35},end:{line:18,column:1}},line:12},'1':{name:'(anonymous_1)',decl:{start:{line:20,column:16},end:{line:20,column:17}},loc:{start:{line:20,column:41},end:{line:33,column:1}},line:20},'2':{name:'(anonymous_2)',decl:{start:{line:27,column:48},end:{line:27,column:49}},loc:{start:{line:27,column:70},end:{line:32,column:5}},line:27},'3':{name:'(anonymous_3)',decl:{start:{line:35,column:25},end:{line:35,column:26}},loc:{start:{line:35,column:50},end:{line:84,column:1}},line:35},'4':{name:'(anonymous_4)',decl:{start:{line:42,column:52},end:{line:42,column:53}},loc:{start:{line:42,column:74},end:{line:80,column:9}},line:42},'5':{name:'(anonymous_5)',decl:{start:{line:51,column:36},end:{line:51,column:37}},loc:{start:{line:51,column:61},end:{line:73,column:13}},line:51},'6':{name:'(anonymous_6)',decl:{start:{line:75,column:34},end:{line:75,column:35}},loc:{start:{line:75,column:53},end:{line:79,column:13}},line:75}},branchMap:{'0':{loc:{start:{line:28,column:8},end:{line:28,column:35}},type:'if',locations:[{start:{line:28,column:8},end:{line:28,column:35}},{start:{line:28,column:8},end:{line:28,column:35}}],line:28},'1':{loc:{start:{line:36,column:4},end:{line:83,column:5}},type:'if',locations:[{start:{line:36,column:4},end:{line:83,column:5}},{start:{line:36,column:4},end:{line:83,column:5}}],line:36},'2':{loc:{start:{line:43,column:12},end:{line:43,column:39}},type:'if',locations:[{start:{line:43,column:12},end:{line:43,column:39}},{start:{line:43,column:12},end:{line:43,column:39}}],line:43},'3':{loc:{start:{line:76,column:16},end:{line:76,column:66}},type:'if',locations:[{start:{line:76,column:16},end:{line:76,column:66}},{start:{line:76,column:16},end:{line:76,column:66}}],line:76}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var ERR=(++cov_2m26hkwnj2.s[0],require('async-stacktrace'));var _=(++cov_2m26hkwnj2.s[1],require('lodash'));var csvStringify=(++cov_2m26hkwnj2.s[2],require('csv').stringify);var express=(++cov_2m26hkwnj2.s[3],require('express'));var router=(++cov_2m26hkwnj2.s[4],express.Router());var sqldb=(++cov_2m26hkwnj2.s[5],require('../../lib/sqldb'));var sqlLoader=(++cov_2m26hkwnj2.s[6],require('../../lib/sql-loader'));var sql=(++cov_2m26hkwnj2.s[7],sqlLoader.loadSqlEquiv(__filename));++cov_2m26hkwnj2.s[8];var csvFilename=function(locals){++cov_2m26hkwnj2.f[0];++cov_2m26hkwnj2.s[9];return locals.course.short_name.replace(/\s+/g,'')+'_'+locals.course_instance.short_name.replace(/\s+/g,'')+'_'+'assessment_stats.csv';};++cov_2m26hkwnj2.s[10];router.get('/',function(req,res,next){++cov_2m26hkwnj2.f[1];++cov_2m26hkwnj2.s[11];res.locals.csvFilename=csvFilename(res.locals);var params=(++cov_2m26hkwnj2.s[12],{course_instance_id:res.locals.course_instance.id,authz_data:res.locals.authz_data,req_date:res.locals.req_date});++cov_2m26hkwnj2.s[13];sqldb.query(sql.select_assessments,params,function(err,result){++cov_2m26hkwnj2.f[2];++cov_2m26hkwnj2.s[14];if(ERR(err,next)){++cov_2m26hkwnj2.b[0][0];++cov_2m26hkwnj2.s[15];return;}else{++cov_2m26hkwnj2.b[0][1];}++cov_2m26hkwnj2.s[16];res.locals.rows=result.rows;++cov_2m26hkwnj2.s[17];res.render(__filename.replace(/\.js$/,'.ejs'),res.locals);});});++cov_2m26hkwnj2.s[18];router.get('/:filename',function(req,res,next){++cov_2m26hkwnj2.f[3];++cov_2m26hkwnj2.s[19];if(req.params.filename==csvFilename(res.locals)){++cov_2m26hkwnj2.b[1][0];var params=(++cov_2m26hkwnj2.s[20],{course_instance_id:res.locals.course_instance.id,authz_data:res.locals.authz_data,req_date:res.locals.req_date});++cov_2m26hkwnj2.s[21];sqldb.query(sql.select_assessments,params,function(err,result){++cov_2m26hkwnj2.f[4];++cov_2m26hkwnj2.s[22];if(ERR(err,next)){++cov_2m26hkwnj2.b[2][0];++cov_2m26hkwnj2.s[23];return;}else{++cov_2m26hkwnj2.b[2][1];}var assessmentStats=(++cov_2m26hkwnj2.s[24],result.rows);var csvHeaders=(++cov_2m26hkwnj2.s[25],['Course','Instance','Set','Number','Assessment','Title','TID','NStudents','Mean','Std','Min','Max','Median','NZero','NHundred','NZeroPerc','NHundredPerc','Hist1','Hist2','Hist3','Hist4','Hist5','Hist6','Hist7','Hist8','Hist9','Hist10']);var csvData=(++cov_2m26hkwnj2.s[26],[]);++cov_2m26hkwnj2.s[27];_(assessmentStats).each(function(assessmentStat){++cov_2m26hkwnj2.f[5];var csvRow=(++cov_2m26hkwnj2.s[28],[res.locals.course.short_name,res.locals.course_instance.short_name,assessmentStat.name,assessmentStat.assessment_number,assessmentStat.label,assessmentStat.title,assessmentStat.tid,assessmentStat.number,assessmentStat.mean,assessmentStat.std,assessmentStat.min,assessmentStat.max,assessmentStat.median,assessmentStat.n_zero,assessmentStat.n_hundred,assessmentStat.n_zero_perc,assessmentStat.n_hundred_perc]);++cov_2m26hkwnj2.s[29];csvRow=csvRow.concat(assessmentStat.score_hist);++cov_2m26hkwnj2.s[30];csvData.push(csvRow);});++cov_2m26hkwnj2.s[31];csvData.splice(0,0,csvHeaders);++cov_2m26hkwnj2.s[32];csvStringify(csvData,function(err,csv){++cov_2m26hkwnj2.f[6];++cov_2m26hkwnj2.s[33];if(err){++cov_2m26hkwnj2.b[3][0];++cov_2m26hkwnj2.s[34];throw Error('Error formatting CSV',err);}else{++cov_2m26hkwnj2.b[3][1];}++cov_2m26hkwnj2.s[35];res.attachment(req.params.filename);++cov_2m26hkwnj2.s[36];res.send(csv);});});}else{++cov_2m26hkwnj2.b[1][1];++cov_2m26hkwnj2.s[37];next(new Error('Unknown filename: '+req.params.filename));}});++cov_2m26hkwnj2.s[38];module.exports=router;